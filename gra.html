<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Pitagoras Go! by Adam Kasprzak 8c</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%236366f1'/><text x='50' y='72' font-size='60' font-weight='900' fill='white' text-anchor='middle' font-family='sans-serif'>œÄ</text></svg>">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
            background-size: 100% 200%;
            animation: skyMove 20s ease infinite alternate;
            height: 100vh;
            user-select: none;
            transition: background 1s ease;
        }

        /* T≈Ça dla poziom√≥w */
        body.level-easy {
            background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 50%, #87ceeb 100%);
        }
        body.level-medium {
            background: linear-gradient(to bottom, #f39c12 0%, #f1c40f 50%, #ffeaa7 100%);
        }
        body.level-hard {
            background: linear-gradient(to bottom, #c0392b 0%, #e74c3c 50%, #2c3e50 100%);
        }

        @keyframes skyMove {
            0% { background-position: 0% 0%; }
            100% { background-position: 0% 100%; }
        }

        /* --- WROGOWIE (Figury) --- */
        .enemy {
            position: absolute;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; color: white;
            z-index: 45;
            will-change: transform;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3));
        }
        .enemy-square {
            width: 50px; height: 50px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border: 2px solid white;
        }
        .enemy-circle {
            width: 50px; height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            border: 2px solid white;
        }
        .enemy-triangle {
            width: 0; height: 0;
            border-left: 30px solid transparent;
            border-right: 30px solid transparent;
            border-bottom: 50px solid #2ecc71;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3));
            background: none; border: none;
        }
        .enemy-triangle::after {
            content: ''; position: absolute;
            top: -25px; left: -30px;
            width: 0; height: 0;
            border-left: 30px solid transparent;
            border-right: 30px solid transparent;
            border-bottom: 50px solid #27ae60;
        }

        /* Pocisk Wroga (Wz√≥r) */
        .enemy-projectile {
            position: absolute;
            background: white; color: #333;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 20px; font-weight: bold;
            border: 3px solid red;
            z-index: 46;
            white-space: nowrap;
            will-change: transform;
            box-shadow: 0 0 10px red;
        }

        /* Power-upy (Niespodzianki) */
        .powerup {
            position: absolute;
            width: 55px; height: 55px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            z-index: 47;
            will-change: transform;
            background: linear-gradient(135deg, #9b59b6, #8e44ad, #e74c3c);
            border: 3px solid #f1c40f;
            box-shadow: 0 0 20px rgba(241, 196, 15, 0.6), 0 0 30px rgba(155, 89, 182, 0.4);
            animation: mysteryGlow 1s ease-in-out infinite alternate;
        }
        .powerup-inner {
            animation: mysteryShake 0.5s ease-in-out infinite;
        }
        @keyframes mysteryGlow {
            0% { box-shadow: 0 0 15px rgba(241, 196, 15, 0.5), 0 0 25px rgba(155, 89, 182, 0.3); }
            100% { box-shadow: 0 0 25px rgba(241, 196, 15, 0.8), 0 0 40px rgba(231, 76, 60, 0.5); }
        }
        @keyframes mysteryShake {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        /* --- UI (Prosty Interfejs) --- */
        #ui-bar {
            position: absolute;
            top: 0; left: 0; width: 100%;
            padding: 15px 30px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-size: 24px;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .ui-group { display: flex; gap: 20px; align-items: center; }
        
        #hearts { color: #ff4757; font-size: 30px; letter-spacing: 5px; }
        
        #fuel-container {
            width: 200px; height: 20px;
            background: rgba(0,0,0,0.3);
            border: 2px solid white;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        #fuel-bar {
            height: 100%; width: 100%;
            background: linear-gradient(90deg, #ff9f43, #feca57);
            transition: width 0.1s linear;
        }
        #fuel-label {
            position: absolute; width: 100%; text-align: center;
            font-size: 14px; line-height: 20px; top: 0;
        }
        
        #progress-container {
            width: 150px; height: 20px;
            background: rgba(0,0,0,0.3);
            border: 2px solid white;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-left: 8px;
        }
        #progress-bar {
            height: 100%; width: 0%;
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            transition: width 0.3s ease-out;
        }
        #progress-label {
            position: absolute; width: 100%; text-align: center;
            font-size: 14px; line-height: 20px; top: 0;
        }
        
        /* Fajerwerki */
        .firework-particle {
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9999;
            animation: fireworkExplode 2s ease-out forwards;
        }
        
        .firework-particle.large {
            width: 20px;
            height: 20px;
        }
        
        .firework-particle.star {
            width: 0;
            height: 0;
            border-radius: 0;
            background: transparent !important;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 16px solid var(--color);
            filter: drop-shadow(0 0 8px var(--color));
        }
        
        @keyframes fireworkExplode {
            0% {
                transform: translate(0, 0) scale(1.5);
                opacity: 1;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }
        
        .firework-trail {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9998;
            animation: trailFade 1.2s ease-out forwards;
        }
        
        @keyframes trailFade {
            0% { opacity: 1; transform: scale(1.5); }
            100% { opacity: 0; transform: scale(0.3); }
        }
        
        .firework-ring {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            z-index: 9997;
            border: 4px solid;
            animation: ringExpand 1s ease-out forwards;
        }
        
        @keyframes ringExpand {
            0% { transform: scale(0); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }

        /* --- WARSTWA GRY --- */
        #game-area {
            position: relative;
            width: 100%; height: 100%;
            overflow: hidden;
        }

        /* Chmury */
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50px;
            z-index: 1;
        }

        /* My≈õliwiec */
        #player {
            position: absolute;
            width: 100px; height: 50px;
            z-index: 50;
            filter: drop-shadow(5px 10px 10px rgba(0,0,0,0.3));
            will-change: transform;
        }

        /* Cele (Targety) */
        .target {
            position: absolute;
            width: 60px; height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #2ecc71, #27ae60); /* domy≈õlnie zielony */
            border: 4px solid white;
            display: flex; justify-content: center; align-items: center;
            color: white; font-weight: bold; font-size: 20px;
            z-index: 40;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            will-change: transform;
        }
        
        .target-content {
            width: 100%; height: 100%;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            animation: targetPulse 1.5s infinite alternate ease-in-out;
        }

        @keyframes targetPulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }
        
        /* Kolory target√≥w wed≈Çug trudno≈õci pytania */
        .target-easy { background: radial-gradient(circle at 30% 30%, #2ecc71, #27ae60); }
        .target-medium { background: radial-gradient(circle at 30% 30%, #f1c40f, #f39c12); }
        .target-hard { background: radial-gradient(circle at 30% 30%, #e74c3c, #c0392b); }

        /* Rakieta */
        .missile {
            position: absolute;
            width: 30px; height: 8px;
            background: #fff;
            border-radius: 4px;
            box-shadow: 0 0 10px #fff, 0 0 20px #00f2fe;
            z-index: 45;
            will-change: transform;
        }
        .missile::after {
            content: ''; position: absolute;
            top: 2px; left: -20px; width: 20px; height: 4px;
            background: linear-gradient(to left, rgba(255,255,255,0.8), transparent);
            border-radius: 2px;
        }
        
        /* Laser (UFO) - POTƒò≈ªNY PROMIE≈É */
        .laser {
            position: absolute;
            width: 2000px; height: 12px;
            background: linear-gradient(90deg, 
                rgba(0,255,0,0) 0%, 
                #00ff00 2%, 
                #7fff00 10%, 
                #ffffff 50%, 
                #7fff00 90%, 
                #00ff00 98%,
                rgba(0,255,0,0) 100%);
            border-radius: 6px;
            box-shadow: 
                0 0 20px #00ff00, 
                0 0 40px #7fff00, 
                0 0 60px #00ff00,
                0 0 80px #adff2f,
                0 0 100px rgba(0,255,0,0.5);
            z-index: 45;
            will-change: transform;
            animation: laserBeam 0.05s ease-in-out infinite alternate;
        }
        .laser::before {
            content: ''; position: absolute;
            top: -8px; left: 0; right: 0; height: 8px;
            background: linear-gradient(90deg, transparent 0%, rgba(0,255,0,0.3) 10%, rgba(255,255,255,0.6) 50%, rgba(0,255,0,0.3) 90%, transparent 100%);
            border-radius: 4px;
            filter: blur(4px);
        }
        .laser::after {
            content: ''; position: absolute;
            top: 12px; left: 0; right: 0; height: 8px;
            background: linear-gradient(90deg, transparent 0%, rgba(0,255,0,0.3) 10%, rgba(255,255,255,0.6) 50%, rgba(0,255,0,0.3) 90%, transparent 100%);
            border-radius: 4px;
            filter: blur(4px);
        }
        @keyframes laserBeam {
            0% { 
                opacity: 0.9; 
                box-shadow: 0 0 15px #00ff00, 0 0 30px #7fff00, 0 0 50px #00ff00;
                height: 10px;
            }
            100% { 
                opacity: 1; 
                box-shadow: 0 0 30px #00ff00, 0 0 60px #7fff00, 0 0 100px #00ff00, 0 0 150px rgba(127,255,0,0.5);
                height: 14px;
            }
        }
        
        /* UFO Timer Bar */
        #ufo-timer {
            position: fixed;
            bottom: 20px; left: 50%;
            transform: translateX(-50%);
            width: 300px; height: 25px;
            background: rgba(0,0,0,0.5);
            border: 3px solid #00ff00;
            border-radius: 15px;
            overflow: hidden;
            z-index: 150;
            display: none;
            box-shadow: 0 0 20px #00ff00, 0 0 40px rgba(0,255,0,0.3);
        }
        #ufo-timer-bar {
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, #00ff00, #7fff00, #adff2f);
            transition: width 0.1s linear;
            box-shadow: inset 0 0 10px rgba(255,255,255,0.5);
        }
        #ufo-timer-label {
            position: absolute;
            width: 100%; text-align: center;
            font-size: 14px; line-height: 25px;
            color: white; font-weight: bold;
            text-shadow: 0 0 10px #000;
        }
        
        /* UFO Player */
        #player.ufo-mode {
            width: 140px !important;
            height: 70px !important;
        }
        #player.ufo-mode svg {
            filter: drop-shadow(0 0 20px #00ff00) drop-shadow(0 0 40px #7fff00);
        }
        @keyframes ufoGlow {
            0%, 100% { filter: drop-shadow(0 0 20px #00ff00) drop-shadow(0 0 40px #7fff00); }
            50% { filter: drop-shadow(0 0 30px #00ff00) drop-shadow(0 0 60px #adff2f); }
        }
        #player.ufo-mode { animation: ufoGlow 1s ease-in-out infinite; }

        /* --- WYBUCHY I ATOM√ìWKA --- */
        #nuke-flash {
            display: none; position: fixed; inset: 0;
            background: white; z-index: 999;
        }
        @keyframes nukeFlash {
            0% { opacity: 0.9; background: #ff4757; }
            50% { opacity: 1; background: #fff; }
            100% { opacity: 0; }
        }

        .screen-shake { animation: shake 0.15s ease-in-out; }
        @keyframes shake {
            0%, 100% { transform: translate3d(0, 0, 0); }
            25% { transform: translate3d(-8px, 4px, 0); }
            50% { transform: translate3d(8px, -4px, 0); }
            75% { transform: translate3d(-4px, -4px, 0); }
        }
        
        .nuke-text {
            position: fixed;
            font-size: 80px;
            font-weight: bold;
            color: #ff4757;
            text-shadow: 0 0 20px #ff0000, 0 0 40px #ff4757;
            z-index: 200;
            pointer-events: none;
            animation: nukeBoom 0.4s ease-out forwards;
        }
        @keyframes nukeBoom {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            50% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }

        .explosion-particle { position: absolute; border-radius: 50%; pointer-events: none; z-index: 60; }

        /* --- MODAL ZADANIA --- */
        #modal-overlay {
            display: none; position: absolute; inset: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 200; justify-content: center; align-items: center;
        }
        #question-box {
            background: white; padding: 25px; border-radius: 15px;
            min-width: 520px; max-width: 650px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 4px solid #333;
        }
        #question-box h2 {
            white-space: pre-line;
            font-family: 'Segoe UI', sans-serif;
            font-size: 20px;
            line-height: 1.4;
            text-align: center;
            margin: 10px 0;
        }
        #question-img {
            margin: 15px auto;
            display: block;
        }
        #question-img svg {
            max-width: 280px;
            max-height: 180px;
        }
        #timer-bar-bg { width: 100%; height: 10px; background: #ddd; margin-bottom: 20px; }
        #timer-bar { width: 100%; height: 100%; background: #ff4757; }
        
        .ans-btn {
            width: 45%; padding: 15px 15px 15px 35px; margin: 10px;
            font-size: 18px; cursor: pointer;
            background: #f1f2f6; border: 2px solid #ccc; border-radius: 8px;
            transition: 0.2s; font-weight: bold; color: #333;
            position: relative; text-align: center;
        }
        /* Bez efektu hover - tylko selected */
        .ans-btn.selected { 
            background: #74b9ff; 
            border-color: #0984e3; 
            box-shadow: 0 0 0 3px rgba(9, 132, 227, 0.3);
            transform: scale(1.02);
        }
        .ans-key {
            position: absolute;
            top: 4px; left: 4px;
            background: rgba(52, 152, 219, 0.8); color: white;
            width: 20px; height: 20px; border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            font-size: 11px; font-weight: bold;
        }
        .ans-btn.selected .ans-key { background: rgba(39, 174, 96, 0.9); }

        /* --- START & GAME OVER --- */
        #menu-screen {
            position: absolute; inset: 0;
            background: linear-gradient(135deg, #0a0f1a 0%, #1a1a2e 50%, #16213e 100%);
            color: white; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 500;
            overflow: hidden;
        }
        
        /* Animowane wzory matematyczne w tle */
        .math-bg {
            position: absolute;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
        }
        .math-symbol {
            position: absolute;
            font-size: 28px;
            color: rgba(241, 196, 15, 0.25);
            font-family: 'Times New Roman', serif;
            animation: floatUp linear infinite;
            will-change: transform;
            text-shadow: 0 0 10px rgba(241, 196, 15, 0.3);
        }
        @keyframes floatUp {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }
        
        /* Siatka geometryczna */
        .grid-bg {
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(rgba(52, 152, 219, 0.12) 1px, transparent 1px),
                linear-gradient(90deg, rgba(52, 152, 219, 0.12) 1px, transparent 1px);
            background-size: 60px 60px;
            animation: gridMove 25s linear infinite;
        }
        @keyframes gridMove {
            0% { background-position: 0 0; }
            100% { background-position: 50px 50px; }
        }
        
        /* ≈öwiecƒÖce akcenty */
        #menu-screen::before {
            content: '';
            position: absolute; inset: 0;
            background: 
                radial-gradient(ellipse at 15% 25%, rgba(241, 196, 15, 0.2) 0%, transparent 45%),
                radial-gradient(ellipse at 85% 75%, rgba(231, 76, 60, 0.15) 0%, transparent 45%),
                radial-gradient(ellipse at 50% 50%, rgba(52, 152, 219, 0.1) 0%, transparent 50%);
            animation: bgPulse 6s ease-in-out infinite alternate;
            pointer-events: none;
        }
        @keyframes bgPulse {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .menu-content {
            position: relative; z-index: 1;
            display: flex; flex-direction: column; align-items: center;
            animation: fadeIn 0.6s ease-out;
            padding-bottom: 50px;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .game-title {
            font-size: 80px; font-weight: 900; margin: 0 0 25px;
            letter-spacing: 5px;
            background: linear-gradient(135deg, #f1c40f 0%, #e74c3c 50%, #f1c40f 100%);
            background-size: 200% auto;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shine 3s linear infinite;
            filter: drop-shadow(0 4px 10px rgba(241, 196, 15, 0.4));
        }
        @keyframes shine {
            to { background-position: 200% center; }
        }
        
        .game-subtitle {
            font-size: 18px; color: #3498db; margin-bottom: 15px;
            font-weight: 500; letter-spacing: 1px;
        }
        
        /* Autor pod tytu≈Çem */
        .author-name {
            font-size: 24px;
            color: rgba(255,255,255,0.8);
            font-weight: 400;
            letter-spacing: 1px;
            margin: 0 0 35px;
        }
        .author-name span {
            font-weight: 700;
            font-size: 28px;
            background: linear-gradient(135deg, #f1c40f, #e67e22);
            background-clip: text; -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Przycisk pomocy */
        .help-btn {
            background: transparent;
            border: 1px solid rgba(255,255,255,0.3);
            color: rgba(255,255,255,0.7);
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 17px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 25px;
        }
        .help-btn:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            border-color: rgba(255,255,255,0.5);
        }
        
        /* Popup instrukcji */
        .help-popup {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.2s ease-out;
        }
        .help-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 30px 40px;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            animation: popIn 0.3s ease-out;
        }
        @keyframes popIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .help-content h2 {
            text-align: center;
            font-size: 24px;
            color: white;
            margin: 0 0 25px;
            font-weight: 600;
        }
        .help-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        .help-table tr {
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .help-table tr:last-child {
            border-bottom: none;
        }
        .help-table td {
            padding: 12px 0;
            font-size: 15px;
            color: rgba(255,255,255,0.9);
        }
        .help-label {
            color: rgba(255,255,255,0.5);
            width: 100px;
        }
        .help-table kbd {
            background: rgba(255,255,255,0.15);
            padding: 5px 10px;
            border-radius: 5px;
            font-family: monospace;
            font-weight: bold;
            font-size: 14px;
            margin-right: 5px;
        }
        .help-warn {
            text-align: center;
            color: #e74c3c;
            font-size: 14px;
            margin: 15px 0 0;
            padding: 10px;
            background: rgba(231, 76, 60, 0.15);
            border-radius: 8px;
        }
        .help-close-btn {
            display: block;
            width: 100%;
            margin-top: 20px;
            padding: 12px;
            background: linear-gradient(135deg, #3498db, #2980b9);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .help-close-btn:hover {
            transform: translateY(-2px);
        }
        
        /* Stopka menu */
        .menu-footer {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            pointer-events: none;
        }
        .school-name {
            font-size: 15px;
            color: rgba(255,255,255,0.5);
            text-align: center;
            white-space: nowrap;
        }
        
        
        .big-btn {
            margin-top: 20px; padding: 18px 100px; font-size: 26px;
            background: linear-gradient(135deg, #f39c12 0%, #e74c3c 100%);
            border: none; border-radius: 50px;
            cursor: pointer; color: white; font-weight: bold;
            letter-spacing: 1px;
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.4), 0 4px 0 #c0392b;
            transition: all 0.15s ease;
            position: relative; overflow: hidden;
        }
        .big-btn::after {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.25), transparent);
            animation: btnShine 2.5s infinite;
        }
        @keyframes btnShine { 0% { left: -100%; } 50%, 100% { left: 100%; } }
        .big-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(243, 156, 18, 0.5), 0 5px 0 #c0392b; }
        .big-btn:active { transform: translateY(4px); box-shadow: 0 2px 10px rgba(243, 156, 18, 0.3), 0 0 0 #c0392b; }

        /* Countdown */
        .countdown-overlay {
            position: fixed; inset: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 800;
        }
        .countdown-wrapper {
            display: flex; flex-direction: column; align-items: center;
            min-height: 200px; /* Sta≈Ça wysoko≈õƒá ≈ºeby level nie skaka≈Ç */
            justify-content: center;
        }
        .countdown-text {
            font-size: 72px; font-weight: 900;
            color: #f1c40f;
            text-shadow: 0 0 30px rgba(241, 196, 15, 0.6), 0 5px 0 #c68f00;
            animation: countdownPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            text-align: center;
        }
        .countdown-text.go {
            font-size: 90px;
            background: linear-gradient(135deg, #f1c40f 0%, #e74c3c 30%, #ff6b6b 50%, #f1c40f 70%, #e74c3c 100%);
            background-size: 300% auto;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: goPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275), goShine 0.4s linear infinite, goPulse 0.15s ease-in-out infinite;
            filter: drop-shadow(0 8px 25px rgba(231, 76, 60, 0.7)) drop-shadow(0 0 40px rgba(241, 196, 15, 0.5));
            letter-spacing: 4px;
        }
        @keyframes countdownPop {
            0% { transform: scale(0) rotate(-10deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(5deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        .countdown-level {
            font-size: 36px;
            color: #3498db;
            margin-top: 50px;
            letter-spacing: 4px;
            text-shadow: 0 0 20px rgba(52, 152, 219, 0.6), 0 3px 0 #2471a3;
            animation: levelPulse 0.8s ease-in-out infinite alternate;
            position: absolute;
            bottom: 35%;
        }
        @keyframes levelPulse {
            from { opacity: 0.7; transform: scale(1); }
            to { opacity: 1; transform: scale(1.05); }
        }
        @keyframes goPop {
            0% { transform: scale(0) rotate(-15deg); opacity: 0; }
            40% { transform: scale(1.4) rotate(8deg); }
            70% { transform: scale(0.9) rotate(-3deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes goShine {
            0% { background-position: 0% center; }
            100% { background-position: 300% center; }
        }
        @keyframes goPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        /* Hall of Fame */
        .hall-of-fame {
            background: rgba(0, 0, 0, 0.35);
            border: 1px solid rgba(241, 196, 15, 0.25);
            border-radius: 16px; padding: 18px 28px; margin: 15px 0; min-width: 320px;
            backdrop-filter: blur(8px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }
        .hall-of-fame h3 {
            color: #f1c40f; margin: 0 0 15px; text-align: center;
            font-size: 22px; letter-spacing: 2px;
            text-shadow: 0 0 15px rgba(241, 196, 15, 0.4);
        }
        .hall-of-fame-entry {
            display: flex; justify-content: space-between; align-items: center;
            padding: 10px 14px; margin: 5px 0; border-radius: 8px;
            background: rgba(255,255,255,0.03); border-bottom: none;
            font-size: 18px; transition: background 0.2s;
        }
        .hall-of-fame-entry:hover { background: rgba(255,255,255,0.08); }
        .hall-of-fame-entry:first-of-type { background: rgba(241, 196, 15, 0.1); border: 1px solid rgba(241, 196, 15, 0.2); }
        .hall-of-fame-rank { font-size: 20px; width: 35px; }
        .hall-of-fame-name { flex: 1; color: rgba(255,255,255,0.9); }
        .hall-of-fame-score { color: #2ecc71; font-weight: 700; text-shadow: 0 0 8px rgba(46, 204, 113, 0.3); }
        
        /* Game Over specific */
        .game-over-title {
            font-size: 64px; font-weight: 900; margin-bottom: 10px;
            color: #e74c3c;
            text-shadow: 0 0 30px rgba(231, 76, 60, 0.6), 0 4px 0 #c0392b;
            animation: gameOverPulse 1s ease-in-out infinite alternate;
        }
        @keyframes gameOverPulse {
            from { transform: scale(1); text-shadow: 0 0 30px rgba(231, 76, 60, 0.6), 0 4px 0 #c0392b; }
            to { transform: scale(1.02); text-shadow: 0 0 50px rgba(231, 76, 60, 0.8), 0 4px 0 #c0392b; }
        }
        .final-score { font-size: 28px; color: #f1c40f; margin-bottom: 20px; }
        .final-score span { font-size: 42px; font-weight: 900; }
        
        .name-input-overlay {
            position: fixed; inset: 0;
            background: linear-gradient(135deg, rgba(12, 24, 33, 0.97), rgba(44, 62, 80, 0.97));
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 600; color: white;
        }
        .name-input-overlay h1 {
            font-size: 42px; margin-bottom: 5px;
            background: linear-gradient(135deg, #f1c40f, #e67e22);
            background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: pulse 1.5s ease-in-out infinite;
        }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }
        .name-input-overlay h2 { font-size: 26px; color: #2ecc71; margin-bottom: 10px; }
        .name-input-overlay input {
            padding: 16px 22px; font-size: 22px;
            border: 2px solid rgba(241, 196, 15, 0.5); border-radius: 12px;
            background: rgba(255,255,255,0.08); color: white;
            text-align: center; margin: 20px 0; outline: none; width: 260px;
            transition: all 0.2s; backdrop-filter: blur(5px);
        }
        .name-input-overlay input:focus { border-color: #2ecc71; box-shadow: 0 0 20px rgba(46, 204, 113, 0.25); }
        .name-input-overlay input::placeholder { color: rgba(255,255,255,0.4); }

    </style>
</head>
<body class="level-easy">

    <div id="ui-bar">
        <div class="ui-group">
            <div>POZIOM: <span id="level-name" style="color: #f1c40f">EASY</span></div>
            <div style="margin-left: 15px;">CEL:</div>
            <div id="progress-container">
                <div id="progress-label">0%</div>
                <div id="progress-bar"></div>
            </div>
        </div>
        <div class="ui-group">
            <div id="hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
            <div style="margin-left: 15px;">üî´ <span id="weapon-level">√ó1</span></div>
        </div>
        <div class="ui-group">
            <div>PALIWO:</div>
            <div id="fuel-container">
                <div id="fuel-label">100%</div>
                <div id="fuel-bar"></div>
            </div>
            <div style="margin-left: 20px;">WYNIK: <span id="score">0</span></div>
        </div>
    </div>

    <div id="game-area">
        <div id="player">
            <svg viewBox="0 0 100 50" style="width:100%; height:100%;">
                <defs>
                    <linearGradient id="fuselage" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#7f8c8d;stop-opacity:1" />
                        <stop offset="50%" style="stop-color:#bdc3c7;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#7f8c8d;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="wings" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#95a5a6;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#7f8c8d;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <!-- Engine Flame (Keep existing or improve) -->
                <path d="M0 25 L-15 20 L-15 30 Z" fill="#e67e22" style="animation: flicker 0.1s infinite"/>
                <path d="M-5 25 L-12 22 L-12 28 Z" fill="#f1c40f" style="animation: flicker 0.1s infinite alternate"/>
                
                <!-- Main Body -->
                <path d="M10 20 L90 25 L100 30 L90 35 L10 40 L0 30 Z" fill="url(#fuselage)" stroke="#2c3e50" stroke-width="2"/>
                
                <!-- Wings -->
                <path d="M40 30 L20 50 L70 35 Z" fill="url(#wings)" stroke="#2c3e50" stroke-width="2"/>
                <path d="M40 30 L20 5 L70 25 Z" fill="url(#wings)" stroke="#2c3e50" stroke-width="2"/>
                
                <!-- Cockpit -->
                <path d="M60 22 L80 25 L60 28 Z" fill="#3498db" stroke="#2980b9" stroke-width="1"/>
                <path d="M65 23 L75 25 L65 26 Z" fill="rgba(255,255,255,0.6)" /> <!-- Glare -->
                
                <!-- Details -->
                <line x1="30" y1="25" x2="30" y2="35" stroke="#2c3e50" stroke-width="1" opacity="0.5"/>
                <line x1="50" y1="25" x2="50" y2="35" stroke="#2c3e50" stroke-width="1" opacity="0.5"/>
            </svg>
        </div>
        
        <div id="game-objects"></div>
    </div>

    <div id="modal-overlay">
        <div id="question-box">
            <h2 id="q-text">Pytanie?</h2>
            <div id="question-img"></div>
            <div id="timer-bar-bg"><div id="timer-bar"></div></div>
            <div id="ans-container"></div>
        </div>
    </div>

    <div id="nuke-flash"></div>
    
    <div id="ufo-timer">
        <div id="ufo-timer-bar"></div>
        <span id="ufo-timer-label">üõ∏ UFO MODE üõ∏</span>
    </div>

    <div id="menu-screen">
        <!-- Animowane t≈Ço -->
        <div class="grid-bg"></div>
        <div class="math-bg" id="math-bg"></div>
        
        <div class="menu-content">
            <!-- G≈Ç√≥wny tytu≈Ç -->
            <h1 class="game-title">GO Pitagoras GO !</h1>
            
            <!-- Autor -->
            <p class="author-name">by <span>Adam Kasprzak</span></p>
            
            <div id="hall-of-fame" class="hall-of-fame"></div>
            
            <button class="big-btn" onclick="Game.start()">üöÄ LET'S GO GUYS!</button>
            
            <!-- Przycisk instrukcji --><br>
            <button class="help-btn" onclick="showHelp()">Instrukcja jak graƒá</button>
        </div>
        
        <!-- Stopka -->
        <div class="menu-footer">
            <p class="school-name">Spo≈Çeczna Jedynka im. ≈õw. Urszuli Leduchowskiej w Poznaniu</p>
        </div>
    </div>
    
    <!-- Popup instrukcji -->
    <div id="help-popup" class="help-popup" style="display: none;" onclick="hideHelp()">
        <div class="help-content" onclick="event.stopPropagation()">
            <h2>Jak graƒá?</h2>
            
            <table class="help-table">
                <tr>
                    <td class="help-label">Ruch</td>
                    <td><kbd>‚Üë</kbd> <kbd>‚Üì</kbd> <kbd>‚Üê</kbd> <kbd>‚Üí</kbd></td>
                </tr>
                <tr>
                    <td class="help-label">Strza≈Ç</td>
                    <td><kbd>SPACJA</kbd></td>
                </tr>
                <tr>
                    <td class="help-label">Odpowiedzi</td>
                    <td><kbd>1</kbd> <kbd>2</kbd> <kbd>3</kbd> <kbd>4</kbd></td>
                </tr>
            </table>
            
            <p class="help-warn">‚ö†Ô∏è Z≈Ça odpowied≈∫ = -1 ‚ù§Ô∏è</p>
            
            <button class="help-close-btn" onclick="hideHelp()">OK</button>
        </div>
    </div>
    
    <script>
        function showHelp() {
            document.getElementById('help-popup').style.display = 'flex';
        }
        function hideHelp() {
            document.getElementById('help-popup').style.display = 'none';
        }
        // Spacja startuje grƒô z menu (tylko na g≈Ç√≥wnym ekranie, nie przy level completed)
        document.addEventListener('keydown', function(e) {
            if(e.code === 'Space' && document.getElementById('menu-screen').style.display !== 'none') {
                e.preventDefault();
                const helpPopup = document.getElementById('help-popup');
                if(helpPopup.style.display === 'flex') {
                    hideHelp();
                } else if(!Game.running && Game.currentLevelIdx === 0 && Game.score === 0) {
                    // Tylko na g≈Ç√≥wnym menu startowym
                    Game.start();
                }
            }
            if(e.code === 'Escape') {
                hideHelp();
            }
        });
        
        // Generuj p≈ÇywajƒÖce symbole matematyczne
        (function createMathSymbols() {
            const symbols = ['œÄ', '‚àë', '‚à´', '‚àö', 'Œî', '‚àû', 'Œ±', 'Œ≤', 'Œ∏', '¬±', '√∑', '√ó', '=', '+', '‚àí', '%', '¬≤', '¬≥', '‚à†', '‚äø', 'Œª', 'œÜ', 'Œ©'];
            const container = document.getElementById('math-bg');
            const count = 25;
            
            for(let i = 0; i < count; i++) {
                setTimeout(() => {
                    createSymbol();
                }, i * 400);
            }
            
            // CiƒÖgle tw√≥rz nowe symbole
            setInterval(createSymbol, 1000);
            
            function createSymbol() {
                if(document.getElementById('menu-screen').style.display === 'none') return;
                
                const el = document.createElement('span');
                el.className = 'math-symbol';
                el.textContent = symbols[Math.floor(Math.random() * symbols.length)];
                el.style.left = Math.random() * 100 + '%';
                el.style.fontSize = (22 + Math.random() * 28) + 'px';
                el.style.animationDuration = (12 + Math.random() * 10) + 's';
                el.style.animationDelay = '0s';
                container.appendChild(el);
                
                // Usu≈Ñ po animacji
                setTimeout(() => el.remove(), 25000);
            }
        })();
    </script>
    
    <div id="name-input" class="name-input-overlay" style="display: none;">
        <h1>üèÜ NOWY REKORD! üèÜ</h1>
        <h2>Tw√≥j wynik: <span id="final-score">0</span> pkt</h2>
        <input type="text" id="player-name" maxlength="15" placeholder="Wpisz swoje imiƒô...">
        <button class="big-btn" onclick="Game.saveScore()">üíæ ZAPISZ WYNIK</button>
    </div>

    <script>
        /* --- KONFIGURACJA I POZIOMY --- */
        const LEVELS = {
            EASY: {
                name: "EASY",
                color: "#2ecc71",
                targetCount: 5,
                spawnRate: 0.008,
                enemyRate: 0.002,
                enemyScale: 1.5,
                projectileScale: 1.3,
                fuelDrain: 0.015,
                powerupRate: 0.003,    // Szansa na spawn power-upa
                powerups: {            // Wagi (suma = 100)
                    x2: 22,            // Bro≈Ñ x2
                    x3: 10,            // Bro≈Ñ x3
                    x4: 3,             // Bro≈Ñ x4
                    x1: 5,             // Downgrade do x1
                    life: 15,          // Extra ≈ºycie
                    boom: 2,           // BOOM! (atom√≥wka)
                    points: 8,        // +50 punkt√≥w
                    fuel: 18,          // +30% paliwa
                    ufo: 27             // üõ∏ UFO z laserem!
                },
                questions: {
                    easy: [
                        { q: "Suma kƒÖt√≥w ‚ñ≥ = ?", a: "180¬∞", bad: ["360¬∞", "90¬∞", "270¬∞"] },
                        { q: "8¬≤ =", a: "64", bad: ["16", "88", "32"] },
                        { q: "‚àö36 =", a: "6", bad: ["18", "4", "9"] },
                        { q: "9¬≤ =", a: "81", bad: ["18", "99", "72"] },
                        { q: "3 √ó (-3) =", a: "-9", bad: ["9", "-6", "0"] },
                        { q: "Jaki kƒÖt oznaczono?", a: "prosty", bad: ["ostry", "rozwarty", "pe≈Çny"], img: '<svg viewBox="0 0 200 150"><line x1="30" y1="100" x2="170" y2="100" stroke="#333" stroke-width="3"/><line x1="100" y1="100" x2="100" y2="30" stroke="#333" stroke-width="3"/><rect x="100" y="80" width="20" height="20" fill="none" stroke="#e74c3c" stroke-width="2"/></svg>' },
                        { q: "Ten kƒÖt to kƒÖt:", a: "ostry", bad: ["prosty", "rozwarty", "p√≥≈Çpe≈Çny"], img: '<svg viewBox="0 0 200 150"><line x1="30" y1="120" x2="170" y2="120" stroke="#333" stroke-width="3"/><line x1="30" y1="120" x2="100" y2="50" stroke="#333" stroke-width="3"/><path d="M 60 120 A 30 30 0 0 1 50 95" fill="none" stroke="#e74c3c" stroke-width="3"/><text x="65" y="105" font-size="14" fill="#e74c3c">45¬∞</text></svg>' },
                        { q: "Proste a i b sƒÖ:", a: "r√≥wnoleg≈Çe", bad: ["prostopad≈Çe", "sieczne", "pokrywajƒÖce"], img: '<svg viewBox="0 0 200 150"><line x1="20" y1="50" x2="180" y2="50" stroke="#333" stroke-width="3"/><line x1="20" y1="100" x2="180" y2="100" stroke="#333" stroke-width="3"/><text x="185" y="55" font-size="14">a</text><text x="185" y="105" font-size="14">b</text></svg>' },
                        { q: "Proste a i b sƒÖ:", a: "prostopad≈Çe", bad: ["r√≥wnoleg≈Çe", "sieczne", "pokrywajƒÖce"], img: '<svg viewBox="0 0 200 150"><line x1="20" y1="75" x2="180" y2="75" stroke="#333" stroke-width="3"/><line x1="100" y1="20" x2="100" y2="130" stroke="#333" stroke-width="3"/><rect x="100" y="75" width="15" height="15" fill="none" stroke="#e74c3c" stroke-width="2"/><text x="160" y="70" font-size="14">a</text><text x="105" y="35" font-size="14">b</text></svg>' },
                        // Uk≈Çad wsp√≥≈Çrzƒôdnych
                        { q: "Pozioma o≈õ to:", a: "o≈õ X", bad: ["o≈õ Y", "o≈õ Z", "o≈õ g≈Ç√≥wna"] },
                        { q: "Ile ƒáwiartek ma uk≈Çad?", a: "4", bad: ["2", "3", "6"] },
                        { q: "PoczƒÖtek uk≈Çadu to:", a: "O", bad: ["P", "A", "X"] },
                        { q: "Punkt (0,0) to:", a: "poczƒÖtek uk≈Çadu", bad: ["I ƒáwiartka", "o≈õ X", "o≈õ Y"] },
                        { q: "W P(x,y) odciƒôta to:", a: "x", bad: ["y", "obie", "≈ºadna"] },
                        // O≈õ liczbowa
                        { q: "Wiƒôksza: -3 czy -7?", a: "-3", bad: ["-7", "r√≥wne", "nie wiadomo"] },
                        { q: "|-4| =", a: "4", bad: ["-4", "0", "-1"] },
                        { q: "Liczby dodatnie le≈ºƒÖ:", a: "po prawej zera", bad: ["po lewej", "na g√≥rze", "na dole"] },
                        { q: "Liczba przeciwna do 5:", a: "-5", bad: ["5", "0", "1/5"] },
                        { q: "Bli≈ºej zera: -2 czy 3?", a: "-2", bad: ["3", "tak samo", "nie wiadomo"] },
                        // Podzielno≈õƒá
                        { q: "Dzielnik 20:", a: "5", bad: ["3", "6", "7"] },
                        { q: "Wielokrotno≈õƒá 4:", a: "16", bad: ["10", "14", "18"] },
                        { q: "Dzielnik√≥w l. pierwszej:", a: "2", bad: ["1", "3", "wiele"] },
                        { q: "Liczba pierwsza:", a: "17", bad: ["9", "15", "21"] },
                        { q: "Czy 1 jest pierwsza?", a: "Nie", bad: ["Tak", "Czasami", "Zale≈ºy"] },
                        // ZaokrƒÖglanie
                        { q: "47 ‚âà (dziesiƒÖtki):", a: "50", bad: ["40", "47", "45"] },
                        { q: "W g√≥rƒô zaokrƒÖgla:", a: "5-9", bad: ["0-4", "1-4", "6-9"] },
                        { q: "123 ‚âà (dziesiƒÖtki):", a: "120", bad: ["100", "130", "125"] },
                        { q: "2,7 ‚âà (jedno≈õci):", a: "3", bad: ["2", "2,5", "2,8"] },
                        { q: "84 ‚âà (dziesiƒÖtki):", a: "80", bad: ["90", "85", "84"] }
                    ],
                    medium: [
                        { q: "Jaki to tr√≥jkƒÖt?", a: "prostokƒÖtny", bad: ["ostrokƒÖtny", "rozwartokƒÖtny", "r√≥wnoboczny"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 30,30 170,130" fill="none" stroke="#333" stroke-width="3"/><rect x="30" y="110" width="20" height="20" fill="none" stroke="#e74c3c" stroke-width="2"/><text x="50" y="55" font-size="12">90¬∞</text></svg>' },
                        { q: "Jaki to tr√≥jkƒÖt?", a: "r√≥wnoramienny", bad: ["r√≥wnoboczny", "r√≥≈ºnoboczny", "prostokƒÖtny"], img: '<svg viewBox="0 0 200 150"><polygon points="100,20 40,130 160,130" fill="none" stroke="#333" stroke-width="3"/><text x="55" y="75" font-size="14">5</text><text x="135" y="75" font-size="14">5</text><text x="95" y="145" font-size="14">6</text></svg>' },
                        { q: "Jaki to tr√≥jkƒÖt?", a: "r√≥wnoboczny", bad: ["r√≥wnoramienny", "r√≥≈ºnoboczny", "prostokƒÖtny"], img: '<svg viewBox="0 0 200 150"><polygon points="100,20 30,130 170,130" fill="none" stroke="#333" stroke-width="3"/><text x="55" y="70" font-size="12">60¬∞</text><text x="125" y="70" font-size="12">60¬∞</text><text x="95" y="115" font-size="12">60¬∞</text></svg>' },
                        { q: "Oblicz obw√≥d ‚ñ≥:", a: "12", bad: ["15", "10", "18"], img: '<svg viewBox="0 0 200 150"><polygon points="100,30 40,130 160,130" fill="none" stroke="#333" stroke-width="3"/><text x="55" y="75" font-size="14">3</text><text x="135" y="75" font-size="14">4</text><text x="95" y="145" font-size="14">5</text></svg>' },
                        { q: "Ten kƒÖt to kƒÖt:", a: "rozwarty", bad: ["prosty", "ostry", "pe≈Çny"], img: '<svg viewBox="0 0 200 150"><line x1="20" y1="100" x2="180" y2="100" stroke="#333" stroke-width="3"/><line x1="100" y1="100" x2="40" y2="30" stroke="#333" stroke-width="3"/><path d="M 70 100 A 35 35 0 0 1 72 72" fill="none" stroke="#e74c3c" stroke-width="3"/><text x="85" y="80" font-size="14" fill="#e74c3c">120¬∞</text></svg>' },
                        { q: "Oblicz kƒÖt Œ±:", a: "60¬∞", bad: ["30¬∞", "90¬∞", "45¬∞"], img: '<svg viewBox="0 0 200 150"><polygon points="100,20 30,130 170,130" fill="none" stroke="#333" stroke-width="3"/><text x="100" y="45" text-anchor="middle" font-size="14">Œ±</text><text x="45" y="125" font-size="14">60¬∞</text><text x="145" y="125" font-size="14">60¬∞</text></svg>' },
                        { q: "Suma kƒÖt√≥w Œ± + Œ≤ + Œ≥ = ?", a: "180¬∞", bad: ["360¬∞", "90¬∞", "270¬∞"], img: '<svg viewBox="0 0 200 150"><polygon points="100,20 30,130 170,130" fill="none" stroke="#333" stroke-width="3"/><text x="100" y="42" font-size="13">Œ±</text><text x="48" y="120" font-size="13">Œ≤</text><text x="142" y="120" font-size="13">Œ≥</text></svg>' },
                        { q: "KƒÖt przy wierzch. = ?", a: "40¬∞", bad: ["70¬∞", "80¬∞", "50¬∞"], img: '<svg viewBox="0 0 200 150"><polygon points="100,20 40,130 160,130" fill="none" stroke="#333" stroke-width="3"/><text x="93" y="50" font-size="14" fill="#e74c3c">?</text><text x="55" y="115" font-size="14">70¬∞</text><text x="130" y="115" font-size="14">70¬∞</text><text x="75" y="145" font-size="10">r√≥wnoramienny</text></svg>' },
                        { q: "KƒÖt Œ± = ?", a: "70¬∞", bad: ["110¬∞", "80¬∞", "90¬∞"], img: '<svg viewBox="0 0 200 150"><polygon points="100,25 30,130 170,130" fill="none" stroke="#333" stroke-width="3"/><text x="93" y="50" font-size="14" fill="#e74c3c">Œ±=?</text><text x="45" y="120" font-size="14">55¬∞</text><text x="138" y="120" font-size="14">55¬∞</text></svg>' }
                    ],
                    hard: [
                        { q: "Oblicz x (Pitagoras):", a: "5", bad: ["6", "7", "4"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 30,30 150,130" fill="none" stroke="#333" stroke-width="3"/><rect x="30" y="110" width="20" height="20" fill="none" stroke="#e74c3c" stroke-width="2"/><text x="15" y="85" font-size="14">3</text><text x="85" y="145" font-size="14">4</text><text x="95" y="70" font-size="14" fill="#e74c3c">x=?</text></svg>' },
                        { q: "Wysoko≈õƒá h = ?", a: "8", bad: ["10", "6", "12"], img: '<svg viewBox="0 0 200 150"><polygon points="100,20 30,130 170,130" fill="none" stroke="#333" stroke-width="3"/><line x1="100" y1="20" x2="100" y2="130" stroke="#e74c3c" stroke-width="2" stroke-dasharray="5,5"/><text x="108" y="80" font-size="14" fill="#e74c3c">h=?</text><text x="90" y="145" font-size="12">a=10</text><text x="55" y="15" font-size="12">P=40</text></svg>' },
                        { q: "Pole ‚ñ≥ = ?", a: "24", bad: ["48", "12", "36"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 170,130 170,30" fill="none" stroke="#333" stroke-width="3"/><rect x="150" y="110" width="20" height="20" fill="none" stroke="#333" stroke-width="1"/><text x="90" y="145" font-size="14">8</text><text x="175" y="85" font-size="14">6</text></svg>' },
                        { q: "Tr√≥jkƒÖt rozwartokƒÖtny\nma kƒÖt:", a: "> 90¬∞", bad: ["< 90¬∞", "= 90¬∞", "= 180¬∞"], img: '<svg viewBox="0 0 200 150"><polygon points="20,50 180,50 100,130" fill="none" stroke="#333" stroke-width="3"/><path d="M 75 130 A 30 30 0 0 1 125 130" fill="none" stroke="#e74c3c" stroke-width="3"/><text x="85" y="115" font-size="12" fill="#e74c3c">120¬∞</text></svg>' },
                        { q: "KƒÖt zewnƒôtrzny ‚ñ≥ = ?", a: "130¬∞", bad: ["50¬∞", "180¬∞", "100¬∞"], img: '<svg viewBox="0 0 200 150"><polygon points="40,120 100,30 160,120" fill="none" stroke="#333" stroke-width="3"/><line x1="160" y1="120" x2="195" y2="120" stroke="#333" stroke-width="2"/><text x="90" y="55" font-size="12">80¬∞</text><text x="55" y="115" font-size="11">50¬∞</text><text x="135" y="115" font-size="11">50¬∞</text><text x="167" y="108" font-size="12" fill="#e74c3c">?</text><path d="M 175 120 A 15 15 0 0 0 168 107" fill="none" stroke="#e74c3c" stroke-width="2"/></svg>' },
                        { q: "PrzyprostokƒÖtna = ?", a: "6", bad: ["8", "10", "4"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 30,30 130,130" fill="none" stroke="#333" stroke-width="3"/><rect x="30" y="110" width="20" height="20" fill="none" stroke="#333" stroke-width="1"/><text x="10" y="85" font-size="14" fill="#e74c3c">?</text><text x="75" y="145" font-size="14">8</text><text x="85" y="70" font-size="14">10</text></svg>' },
                        { q: "Ile wynosi x?", a: "13", bad: ["12", "14", "15"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 30,30 150,130" fill="none" stroke="#333" stroke-width="3"/><rect x="30" y="110" width="20" height="20" fill="none" stroke="#e74c3c" stroke-width="2"/><text x="12" y="85" font-size="14">5</text><text x="85" y="145" font-size="14">12</text><text x="95" y="70" font-size="14" fill="#e74c3c">x=?</text></svg>' },
                        { q: "Oblicz pole ‚ñ≥:", a: "30", bad: ["60", "15", "45"], img: '<svg viewBox="0 0 200 150"><polygon points="100,25 30,130 170,130" fill="none" stroke="#333" stroke-width="3"/><line x1="100" y1="25" x2="100" y2="130" stroke="#999" stroke-width="1" stroke-dasharray="4,4"/><text x="108" y="80" font-size="12">h=6</text><text x="90" y="145" font-size="12">a=10</text></svg>' }
                    ]
                }
            },
            MEDIUM: {
                name: "MEDIUM",
                color: "#f1c40f",
                targetCount: 8,
                spawnRate: 0.015,
                enemyRate: 0.01,
                enemyScale: 1.7,
                projectileScale: 1.5,
                fuelDrain: 0.025,
                powerupRate: 0.004,
                powerups: {
                    x2: 18, x3: 13, x4: 5, x1: 8,
                    life: 12, boom: 3, points: 6, fuel: 15, ufo: 20
                },
                questions: {
                    easy: [
                        { q: "‚àö81 =", a: "9", bad: ["8", "7", "99"] },
                        { q: "2‚Åµ =", a: "32", bad: ["10", "25", "64"] },
                        { q: "(-2)¬≥ =", a: "-8", bad: ["8", "-6", "6"] },
                        { q: "Suma kƒÖt√≥w w 4-kƒÖcie:", a: "360¬∞", bad: ["180¬∞", "270¬∞", "540¬∞"] },
                        { q: "Ile przekƒÖtnych ma ‚ñ≥?", a: "0", bad: ["1", "3", "2"] },
                        { q: "≈örodkowa dzieli bok:", a: "na p√≥≈Ç", bad: ["na 3", "na 4", "nier√≥wno"] },
                        { q: "KƒÖty Œ± i Œ≤ sƒÖ:", a: "wierzcho≈Çkowe", bad: ["przyleg≈Çe", "odpowiadajƒÖce", "dope≈ÇniajƒÖce"], img: '<svg viewBox="0 0 200 150"><line x1="30" y1="30" x2="170" y2="120" stroke="#333" stroke-width="2"/><line x1="30" y1="120" x2="170" y2="30" stroke="#333" stroke-width="2"/><text x="95" y="55" font-size="14">Œ±</text><text x="95" y="110" font-size="14">Œ≤</text></svg>' },
                        { q: "Œ± + Œ≤ = ?", a: "180¬∞", bad: ["90¬∞", "360¬∞", "270¬∞"], img: '<svg viewBox="0 0 200 150"><line x1="20" y1="75" x2="180" y2="75" stroke="#333" stroke-width="3"/><line x1="100" y1="75" x2="140" y2="25" stroke="#333" stroke-width="3"/><text x="70" y="70" font-size="14">Œ±</text><text x="115" y="70" font-size="14">Œ≤</text></svg>' },
                        // Uk≈Çad wsp√≥≈Çrzƒôdnych
                        { q: "A(3,-2) le≈ºy w:", a: "IV ƒáwiartce", bad: ["I", "II", "III"] },
                        { q: "Znaki w III ƒáwiartce:", a: "(-, -)", bad: ["(+, +)", "(-, +)", "(+, -)"] },
                        { q: "B(-5, 0) le≈ºy na:", a: "osi X", bad: ["osi Y", "I ƒáw.", "III ƒáw."] },
                        { q: "I ƒáwiartka to:", a: "prawa g√≥rna", bad: ["lewa g√≥rna", "lewa dolna", "prawa dolna"] },
                        { q: "Symetryczny do (2,3) wzgl. Y:", a: "(-2, 3)", bad: ["(2, -3)", "(-2, -3)", "(3, 2)"] },
                        // O≈õ liczbowa
                        { q: "RosnƒÖco: -3, 1, -1, 0", a: "-3,-1,0,1", bad: ["1,0,-1,-3", "-1,-3,0,1", "0,-1,1,-3"] },
                        { q: "|‚àí8| + |3| =", a: "11", bad: ["5", "-5", "-11"] },
                        { q: "Miƒôdzy -2,5 a -1,5:", a: "-2", bad: ["-3", "-1", "0"] },
                        { q: "a + (-a) =", a: "0", bad: ["1", "-1", "2a"] },
                        { q: "Prawdziwa nier√≥wno≈õƒá:", a: "-5 < -2", bad: ["-5 > -2", "-5 = -2", "-5 > 2"] },
                        // Podzielno≈õƒá
                        { q: "Dzielnik√≥w liczby 12:", a: "6", bad: ["4", "5", "7"] },
                        { q: "NWD(8, 12) =", a: "4", bad: ["2", "6", "24"] },
                        { q: "NWW(4, 6) =", a: "12", bad: ["2", "24", "10"] },
                        { q: "24 = ?", a: "2¬≥¬∑3", bad: ["2¬∑12", "4¬∑6", "8¬∑3"] },
                        { q: "Wzglƒôdnie pierwsze:", a: "8 i 15", bad: ["4 i 6", "9 i 12", "10 i 25"] },
                        // ZaokrƒÖglanie
                        { q: "3456 ‚âà (setki):", a: "3500", bad: ["3400", "3450", "3000"] },
                        { q: "7,35 ‚âà (dziesiƒÖte):", a: "7,4", bad: ["7,3", "7,0", "7,5"] },
                        { q: "995 ‚âà (dziesiƒÖtki):", a: "1000", bad: ["990", "995", "900"] },
                        { q: "4,444 ‚âà (setne):", a: "4,44", bad: ["4,45", "4,4", "4,50"] },
                        { q: "2850 ‚âà (tysiƒÖce):", a: "3000", bad: ["2000", "2800", "2900"] }
                    ],
                    medium: [
                        { q: "KƒÖty Œ± i Œ≤ sƒÖ:", a: "naprzemianleg≈Çe", bad: ["odpowiadajƒÖce", "wierzcho≈Çkowe", "przyleg≈Çe"], img: '<svg viewBox="0 0 200 150"><line x1="20" y1="40" x2="180" y2="40" stroke="#333" stroke-width="2"/><line x1="20" y1="110" x2="180" y2="110" stroke="#333" stroke-width="2"/><line x1="50" y1="20" x2="150" y2="130" stroke="#e74c3c" stroke-width="2"/><text x="75" y="55" font-size="14">Œ±</text><text x="115" y="105" font-size="14">Œ≤</text><text x="10" y="35" font-size="12">a</text><text x="10" y="105" font-size="12">b</text></svg>' },
                        { q: "KƒÖt Œ≤ = ? (a ‚à• b)", a: "65¬∞", bad: ["115¬∞", "25¬∞", "90¬∞"], img: '<svg viewBox="0 0 200 150"><line x1="20" y1="40" x2="180" y2="40" stroke="#333" stroke-width="2"/><line x1="20" y1="110" x2="180" y2="110" stroke="#333" stroke-width="2"/><line x1="60" y1="20" x2="140" y2="130" stroke="#333" stroke-width="2"/><text x="95" y="55" font-size="14">65¬∞</text><text x="105" y="100" font-size="14" fill="#e74c3c">Œ≤=?</text><text x="185" y="45" font-size="12">a</text><text x="185" y="115" font-size="12">b</text></svg>' },
                        { q: "KƒÖty Œ± i Œ≤ sƒÖ:", a: "odpowiadajƒÖce", bad: ["naprzemianleg≈Çe", "wierzcho≈Çkowe", "przyleg≈Çe"], img: '<svg viewBox="0 0 200 150"><line x1="20" y1="40" x2="180" y2="40" stroke="#333" stroke-width="2"/><line x1="20" y1="110" x2="180" y2="110" stroke="#333" stroke-width="2"/><line x1="50" y1="20" x2="150" y2="130" stroke="#e74c3c" stroke-width="2"/><text x="75" y="55" font-size="14">Œ±</text><text x="75" y="125" font-size="14">Œ≤</text></svg>' },
                        { q: "Oblicz kƒÖt Œ≥:", a: "40¬∞", bad: ["50¬∞", "60¬∞", "30¬∞"], img: '<svg viewBox="0 0 200 150"><polygon points="100,25 30,130 170,130" fill="none" stroke="#333" stroke-width="3"/><text x="93" y="50" font-size="14">80¬∞</text><text x="45" y="120" font-size="14">60¬∞</text><text x="138" y="120" font-size="14" fill="#e74c3c">Œ≥=?</text></svg>' },
                        { q: "Tr√≥jkƒÖty sƒÖ:", a: "podobne", bad: ["przystajƒÖce", "symetryczne", "r√≥≈ºne"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 30,70 90,130" fill="none" stroke="#333" stroke-width="2"/><polygon points="110,130 110,40 200,130" fill="none" stroke="#e74c3c" stroke-width="2"/><text x="45" y="110" font-size="10">3</text><text x="35" y="95" font-size="10">4</text><text x="140" y="100" font-size="10">6</text><text x="120" y="80" font-size="10">8</text></svg>' },
                        { q: "KƒÖt Œ± = ?", a: "35¬∞", bad: ["55¬∞", "45¬∞", "25¬∞"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 30,30 170,130" fill="none" stroke="#333" stroke-width="3"/><rect x="30" y="110" width="20" height="20" fill="none" stroke="#333" stroke-width="1"/><text x="95" y="70" font-size="14" fill="#e74c3c">Œ±=?</text><text x="40" y="75" font-size="12">90¬∞</text><text x="130" y="120" font-size="14">55¬∞</text></svg>' },
                        { q: "Ortocentrum to przeciƒôcie:", a: "wysoko≈õci", bad: ["≈õrodkowych", "dwusiecznych", "symetralnych"] },
                        { q: "Pole ‚ñ≥ = ?", a: "20", bad: ["40", "10", "25"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 170,130 100,30" fill="none" stroke="#333" stroke-width="3"/><line x1="100" y1="30" x2="100" y2="130" stroke="#999" stroke-width="1" stroke-dasharray="4,4"/><text x="108" y="85" font-size="12">h=5</text><text x="90" y="145" font-size="12">a=8</text></svg>' }
                    ],
                    hard: [
                        { q: "Oblicz x (Pitagoras):", a: "10", bad: ["8", "12", "14"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 30,30 150,130" fill="none" stroke="#333" stroke-width="3"/><rect x="30" y="110" width="20" height="20" fill="none" stroke="#333" stroke-width="1"/><text x="12" y="85" font-size="14">6</text><text x="85" y="145" font-size="14">8</text><text x="95" y="70" font-size="14" fill="#e74c3c">x=?</text></svg>' },
                        { q: "Ile wynosi x?", a: "15", bad: ["12", "17", "20"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 30,30 150,130" fill="none" stroke="#333" stroke-width="3"/><rect x="30" y="110" width="20" height="20" fill="none" stroke="#333" stroke-width="1"/><text x="12" y="85" font-size="14">9</text><text x="85" y="145" font-size="14">12</text><text x="95" y="70" font-size="14" fill="#e74c3c">x=?</text></svg>' },
                        { q: "Wysoko≈õƒá h = ?", a: "12", bad: ["10", "15", "8"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 30,30 150,130" fill="none" stroke="#333" stroke-width="3"/><rect x="30" y="110" width="20" height="20" fill="none" stroke="#333" stroke-width="1"/><text x="12" y="85" font-size="14" fill="#e74c3c">h=?</text><text x="85" y="145" font-size="14">9</text><text x="95" y="70" font-size="14">15</text></svg>' },
                        { q: "Oblicz x:", a: "8", bad: ["6", "10", "12"], img: '<svg viewBox="0 0 200 150"><polygon points="100,20 30,130 170,130" fill="none" stroke="#333" stroke-width="3"/><line x1="65" y1="75" x2="135" y2="75" stroke="#999" stroke-width="2"/><text x="95" y="145" font-size="12">12</text><text x="95" y="70" font-size="12" fill="#e74c3c">x=?</text><text x="50" y="95" font-size="10">≈õrodkowa</text></svg>' },
                        { q: "Pole ‚ñ≥ = ? (Heron)", a: "6", bad: ["12", "9", "8"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 170,130 100,50" fill="none" stroke="#333" stroke-width="3"/><text x="55" y="85" font-size="14">4</text><text x="130" y="85" font-size="14">3</text><text x="90" y="145" font-size="14">5</text></svg>' }                            
                    ]
                }
            },
            HARD: {
                name: "HARD",
                color: "#e74c3c",
                targetCount: 10,
                spawnRate: 0.015,
                enemyRate: 0.02,
                enemyScale: 2.0,
                projectileScale: 1.8,
                fuelDrain: 0.035,
                powerupRate: 0.005,
                powerups: {
                    x2: 12, x3: 10, x4: 7, x1: 12,
                    life: 10, boom: 5, points: 13, fuel: 16, ufo: 15
                },
                questions: {
                    easy: [
                        { q: "Suma kƒÖt√≥w ‚ñ≥:", a: "180¬∞", bad: ["360¬∞", "90¬∞", "270¬∞"] },
                        { q: "Liczba œÄ ‚âà", a: "3.14", bad: ["3.41", "2.14", "3.12"] },
                        { q: "‚àö2 ‚âà", a: "1.41", bad: ["1.73", "2.0", "1.5"] },
                        { q: "KƒÖt wpisany na ≈õrednicy:", a: "90¬∞", bad: ["180¬∞", "45¬∞", "60¬∞"] },
                        { q: "Nier√≥wno≈õƒá ‚ñ≥:\na + b ... c", a: "> c", bad: ["< c", "= c", "‚â• c"] },
                        { q: "Obw√≥d ‚ñ≥:", a: "16", bad: ["15", "14", "18"], img: '<svg viewBox="0 0 200 150"><polygon points="100,25 30,130 170,130" fill="none" stroke="#333" stroke-width="3"/><text x="50" y="70" font-size="14">5</text><text x="140" y="70" font-size="14">5</text><text x="95" y="145" font-size="14">6</text></svg>' },
                        { q: "‚ñ≥ o bokach 3, 4, 5\njest:", a: "prostokƒÖtny", bad: ["ostrokƒÖtny", "rozwartokƒÖtny", "r√≥wnoboczny"] },
                        { q: "W ‚ñ≥ prostokƒÖtnym\nnajwiƒôksza jest:", a: "przeciwpr.", bad: ["przyprost.", "wysoko≈õƒá", "≈õrodkowa"] },
                        // Uk≈Çad wsp√≥≈Çrzƒôdnych
                        { q: "Odleg≈Ço≈õƒá (3,4) od (0,0):", a: "5", bad: ["7", "12", "25"] },
                        { q: "Symetryczny do (-2,5) wzgl. O:", a: "(2, -5)", bad: ["(2, 5)", "(-2, -5)", "(5, -2)"] },
                        { q: "≈örodek AB: A(2,4), B(6,8):", a: "(4, 6)", bad: ["(8, 12)", "(4, 4)", "(3, 6)"] },
                        { q: "Odleg≈Ço≈õƒá (0,-4) od (3,0):", a: "5", bad: ["7", "4", "3"] },
                        { q: "P(a,b)‚ààII ƒáw., Q(-a,-b)‚àà?", a: "IV ƒáwiartce", bad: ["I", "II", "III"] },
                        // O≈õ liczbowa
                        { q: "|‚àí3| ‚àí |‚àí7| =", a: "-4", bad: ["4", "10", "-10"] },
                        { q: "|x| = 6, x = ?", a: "¬±6", bad: ["6", "-6", "brak"] },
                        { q: "|a|=|b|, a‚â†b, to:", a: "a = -b", bad: ["a = b", "a+b=1", "a¬∑b=1"] },
                        { q: "Ca≈Çkowite miƒôdzy -3,5 a 2,5:", a: "6", bad: ["5", "7", "4"] },
                        { q: "|‚àí2|¬∑|‚àí3| ‚àí |‚àí1| =", a: "5", bad: ["6", "7", "4"] },
                        // Podzielno≈õƒá
                        { q: "NWD(48, 36) =", a: "12", bad: ["6", "18", "24"] },
                        { q: "NWW(15, 20) =", a: "60", bad: ["30", "45", "300"] },
                        { q: "NWD=6, a¬∑b=180, NWW=?", a: "30", bad: ["36", "15", "1080"] },
                        { q: "Liczb pierwszych < 20:", a: "8", bad: ["6", "7", "9"] },
                        { q: "Suma dzielnik√≥w 28 (bez 28):", a: "28", bad: ["14", "56", "27"] },
                        // ZaokrƒÖglanie
                        { q: "9,995 ‚âà (setne):", a: "10,00", bad: ["9,99", "9,90", "10,10"] },
                        { q: "14567 ‚âà (tysiƒÖce):", a: "15000", bad: ["14000", "14500", "14600"] },
                        { q: "0,0045 ‚âà (tysiƒôczne):", a: "0,005", bad: ["0,004", "0,010", "0,000"] },
                        { q: "Kt√≥ra ‚âà 500 (setki)?", a: "467", bad: ["449", "551", "549"] },
                        { q: "3,1415 ‚âà (setne):", a: "3,14", bad: ["3,15", "3,10", "3,142"] }
                    ],
                    medium: [
                        { q: "≈örodek ciƒô≈ºko≈õci ‚ñ≥:", a: "≈õrodkowych", bad: ["wysoko≈õci", "dwusiecznych", "symetralnych"] },
                        { q: "Ile cech przystawania\ntr√≥jkƒÖt√≥w?", a: "4", bad: ["3", "5", "2"] },
                        { q: "Cecha BBB to:", a: "brak", bad: ["BBB", "cecha I", "cecha IV"] },
                        { q: "Cecha BKB wymaga\nkƒÖta miƒôdzy:", a: "bokami", bad: ["dowolnego", "najwiƒôkszego", "naprzeciw"] },
                        { q: "Czy istnieje ‚ñ≥\no bokach 2, 3, 6?", a: "NIE", bad: ["TAK", "MO≈ªE", "2+3>6"] },
                        { q: "KƒÖt przy podstawie\n‚ñ≥ r√≥wnoramiennego = 70¬∞.\nKƒÖt przy wierzch. = ?", a: "40¬∞", bad: ["70¬∞", "110¬∞", "55¬∞"] },
                        { q: "≈örodek okrƒôgu opisanego\nna ‚ñ≥ to przeciƒôcie:", a: "symetralnych", bad: ["wysoko≈õci", "≈õrodkowych", "dwusiecznych"] },
                        { q: "Stosunek x:y = ?", a: "2:1", bad: ["1:1", "3:1", "1:2"], img: '<svg viewBox="0 0 200 150"><polygon points="100,20 30,130 170,130" fill="none" stroke="#333" stroke-width="3"/><line x1="100" y1="20" x2="100" y2="130" stroke="#999" stroke-width="2"/><circle cx="100" cy="90" r="5" fill="#e74c3c"/><text x="85" y="15" font-size="11">wierzcho≈Çek</text><text x="105" y="60" font-size="12">x</text><text x="105" y="115" font-size="12">y</text><text x="75" y="145" font-size="10">≈õrodek boku</text><text x="105" y="95" font-size="10" fill="#e74c3c">S</text></svg>' }
                    ],
                    hard: [
                        { q: "x = ? (Pitagoras)", a: "17", bad: ["15", "13", "20"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 30,30 170,130" fill="none" stroke="#333" stroke-width="3"/><rect x="30" y="110" width="20" height="20" fill="none" stroke="#333" stroke-width="1"/><text x="10" y="85" font-size="14">8</text><text x="95" y="145" font-size="14">15</text><text x="105" y="70" font-size="14" fill="#e74c3c">x=?</text></svg>' },
                        { q: "x = ? (przyprostokƒÖtna)", a: "12", bad: ["8", "15", "10"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 30,30 150,130" fill="none" stroke="#333" stroke-width="3"/><rect x="30" y="110" width="20" height="20" fill="none" stroke="#333" stroke-width="1"/><text x="10" y="85" font-size="14" fill="#e74c3c">x=?</text><text x="85" y="145" font-size="14">9</text><text x="95" y="70" font-size="14">15</text><text x="50" y="25" font-size="10">x¬≤ + 9¬≤ = 15¬≤</text></svg>' },
                        { q: "PrzeciwprostokƒÖtna = ?", a: "‚àö50", bad: ["‚àö25", "10", "‚àö75"], img: '<svg viewBox="0 0 200 150"><polygon points="30,130 30,30 150,130" fill="none" stroke="#333" stroke-width="3"/><rect x="30" y="110" width="20" height="20" fill="none" stroke="#333" stroke-width="1"/><text x="10" y="85" font-size="14">5</text><text x="85" y="145" font-size="14">5</text><text x="95" y="70" font-size="14" fill="#e74c3c">c=?</text></svg>' },
                        { q: "PrzekƒÖtna kwadratu\na = 6", a: "6‚àö2", bad: ["12", "6", "3‚àö2"], img: '<svg viewBox="0 0 200 150"><rect x="50" y="30" width="100" height="100" fill="none" stroke="#333" stroke-width="3"/><line x1="50" y1="30" x2="150" y2="130" stroke="#e74c3c" stroke-width="2" stroke-dasharray="4,4"/><text x="25" y="85" font-size="14">6</text><text x="95" y="145" font-size="14">6</text><text x="95" y="75" font-size="12" fill="#e74c3c">d=?</text></svg>' },
                        { q: "x = ? (‚ñ≥ podobne)", a: "6", bad: ["4", "8", "9"], img: '<svg viewBox="0 0 200 150"><polygon points="20,130 20,50 80,130" fill="none" stroke="#333" stroke-width="2"/><polygon points="100,130 100,30 190,130" fill="none" stroke="#e74c3c" stroke-width="2"/><text x="5" y="95" font-size="12">4</text><text x="45" y="145" font-size="12">3</text><text x="85" y="85" font-size="12">8</text><text x="135" y="145" font-size="12" fill="#e74c3c">x=?</text></svg>' },
                        { q: "Pole ‚ñ≥ podobnych\nw stosunku 1:3.\nPola w stosunku:", a: "1:9", bad: ["1:3", "1:6", "3:9"] },
                        { q: "‚ñ≥ABC ~ ‚ñ≥DEF, k=3.\nPole DEF gdy PABC=4?", a: "36", bad: ["12", "9", "27"] },
                        { q: "h = ? (wys. ‚ñ≥ r√≥wnob.)", a: "5‚àö3", bad: ["10", "5", "10‚àö3"], img: '<svg viewBox="0 0 200 150"><polygon points="100,15 30,130 170,130" fill="none" stroke="#333" stroke-width="3"/><line x1="100" y1="15" x2="100" y2="130" stroke="#e74c3c" stroke-width="2" stroke-dasharray="4,4"/><text x="55" y="70" font-size="14">10</text><text x="135" y="70" font-size="14">10</text><text x="95" y="145" font-size="14">10</text><text x="105" y="80" font-size="12" fill="#e74c3c">h=?</text></svg>' },
                        { q: "KƒÖt zewnƒôtrzny ‚ñ≥ = ?", a: "110¬∞", bad: ["70¬∞", "180¬∞", "130¬∞"], img: '<svg viewBox="0 0 200 150"><polygon points="30,120 120,120 75,40" fill="none" stroke="#333" stroke-width="3"/><line x1="120" y1="120" x2="180" y2="120" stroke="#e74c3c" stroke-width="2"/><text x="65" y="130" font-size="11">40¬∞</text><text x="90" y="100" font-size="11">30¬∞</text><text x="140" y="110" font-size="12" fill="#e74c3c">?</text><text x="30" y="145" font-size="9">zewn = suma dw√≥ch wewn</text></svg>' },
                        { q: "Promie≈Ñ R = ?\n(okrƒÖg opisany)", a: "5", bad: ["10", "2.5", "7.5"], img: '<svg viewBox="0 0 200 150"><circle cx="100" cy="80" r="55" fill="none" stroke="#333" stroke-width="2"/><polygon points="50,110 150,110 100,35" fill="none" stroke="#e74c3c" stroke-width="2"/><text x="50" y="130" font-size="12">6</text><text x="130" y="130" font-size="12">8</text><text x="95" y="65" font-size="12">10</text><line x1="100" y1="80" x2="145" y2="80" stroke="#999" stroke-width="1" stroke-dasharray="3,3"/><text x="118" y="75" font-size="11" fill="#e74c3c">R=?</text></svg>' }
                    ]
                }
            }
        };

        // Rozdzielczo≈õƒá referencyjna dla normalizacji prƒôdko≈õci
        const REF_WIDTH = 1920;
        const REF_HEIGHT = 1080;
        const TARGET_FPS = 60;
        
        const CONFIG = {
            playerSpeed: 0.8, // %
            fuelDrain: 0.03,
            fuelShotCost: 5,
            enemySpeed: 3 // px/frame (przy rozdzielczo≈õci referencyjnej)
        };

        /* --- SILNIK GRY --- */
        const Game = {
            running: false, paused: false, countdown: false,
            score: 0, fuel: 100, lives: 3,
            currentLevelIdx: 0,
            levelProgress: 0,
            levelKeys: ['EASY', 'MEDIUM', 'HARD'],
            weaponLevel: 1, // 1 = x1, 2 = x2, 3 = x3, 4 = x4
            hasUfo: false, // Tryb UFO z laserem
            
            pX: 10, pY: 50, 
            keys: {}, 
            objects: [], // Targets, Missiles, Enemies, Projectiles, Powerups
            particles: [],
            modalTimer: null,
            width: window.innerWidth, height: window.innerHeight,
            frame: 0,
            loopRunning: false,
            lastFrameTime: 0,
            deltaTime: 1,
            speedScale: 1, // Wsp√≥≈Çczynnik skalowania prƒôdko≈õci
            
            currentQuestions: { easy: [], medium: [], hard: [] }, // Pool for current level by difficulty

            // Oblicz wsp√≥≈Çczynnik skalowania prƒôdko≈õci
            calcSpeedScale() {
                // Skaluj wzglƒôdem diagonali ekranu (≈õrednia geometryczna)
                const refDiag = Math.sqrt(REF_WIDTH * REF_WIDTH + REF_HEIGHT * REF_HEIGHT);
                const curDiag = Math.sqrt(this.width * this.width + this.height * this.height);
                return refDiag / curDiag;
            },

            init() {
                window.addEventListener('resize', () => {
                    this.width = window.innerWidth;
                    this.height = window.innerHeight;
                    this.speedScale = this.calcSpeedScale();
                });
                this.speedScale = this.calcSpeedScale();

                window.addEventListener('keydown', e => {
                    this.keys[e.code] = true;
                    
                    // Obs≈Çuga klawiszy dla odpowiedzi na pytania
                    const modalVisible = document.getElementById('modal-overlay').style.display === 'flex';
                    if(this.paused && modalVisible) {
                        e.preventDefault();
                        const answerBtns = document.querySelectorAll('.ans-btn');
                        const btnCount = answerBtns.length;
                        
                        // Klawisze 1-4
                        if(e.code === 'Digit1' || e.code === 'Numpad1') answerBtns[0]?.click();
                        if(e.code === 'Digit2' || e.code === 'Numpad2') answerBtns[1]?.click();
                        if(e.code === 'Digit3' || e.code === 'Numpad3') answerBtns[2]?.click();
                        if(e.code === 'Digit4' || e.code === 'Numpad4') answerBtns[3]?.click();
                        
                        // Nawigacja strza≈Çkami (siatka 2x2)
                        let selected = document.querySelector('.ans-btn.selected');
                        let idx = selected ? Array.from(answerBtns).indexOf(selected) : -1;
                        
                        if(e.code === 'ArrowRight') idx = (idx === -1) ? 0 : (idx % 2 === 0 && idx + 1 < btnCount) ? idx + 1 : idx;
                        if(e.code === 'ArrowLeft') idx = (idx === -1) ? 0 : (idx % 2 === 1) ? idx - 1 : idx;
                        if(e.code === 'ArrowDown') idx = (idx === -1) ? 0 : (idx + 2 < btnCount) ? idx + 2 : idx;
                        if(e.code === 'ArrowUp') idx = (idx === -1) ? 0 : (idx - 2 >= 0) ? idx - 2 : idx;
                        
                        if(['ArrowRight', 'ArrowLeft', 'ArrowDown', 'ArrowUp'].includes(e.code)) {
                            answerBtns.forEach(b => b.classList.remove('selected'));
                            if(answerBtns[idx]) answerBtns[idx].classList.add('selected');
                        }
                        
                        // Spacja/Enter zatwierdza wyb√≥r
                        if((e.code === 'Space' || e.code === 'Enter') && selected) {
                            selected.click();
                        }
                        return;
                    }
                    
                    if(e.code === 'Space' && this.running && !this.paused) this.shoot();
                });
                window.addEventListener('keyup', e => this.keys[e.code] = false);
                
                this.createInitialClouds();
                this.loop = this.loop.bind(this);
                // Start loop immediately
                this.loopRunning = true;
                requestAnimationFrame(this.loop);
                
                // Hall of Fame
                this.loadHallOfFame();
                this.renderHallOfFame();
            },
            
            // --- HALL OF FAME ---
            getDefaultHallOfFame() {
                return [
                    { name: 'ProfesorX', score: 100 },
                    { name: 'ProfesorX', score: 100 },
                    { name: 'ProfesorX', score: 100 }
                ];
            },
            
            loadHallOfFame() {
                try {
                    const saved = localStorage.getItem('skycommander_halloffame');
                    this.hallOfFame = saved ? JSON.parse(saved) : this.getDefaultHallOfFame();
                } catch(e) {
                    this.hallOfFame = this.getDefaultHallOfFame();
                }
            },
            
            saveHallOfFame() {
                try {
                    localStorage.setItem('skycommander_halloffame', JSON.stringify(this.hallOfFame));
                } catch(e) {
                    console.log('Nie mo≈ºna zapisaƒá Hall of Fame');
                }
            },
            
            renderHallOfFame() {
                const container = document.getElementById('hall-of-fame');
                if(!container) return;
                
                let html = '<h3>üèÜ HALL OF FAME üèÜ</h3>';
                this.hallOfFame.forEach((entry, i) => {
                    const medal = i === 0 ? 'ü•á' : (i === 1 ? 'ü•à' : (i === 2 ? 'ü•â' : ''));
                    html += `
                        <div class="hall-of-fame-entry">
                            <span class="hall-of-fame-rank">${medal || (i+1)+'.'}</span>
                            <span class="hall-of-fame-name">${entry.name}</span>
                            <span class="hall-of-fame-score">${entry.score}</span>
                        </div>
                    `;
                });
                container.innerHTML = html;
            },
            
            isHighScore(score) {
                return this.hallOfFame.length < 3 || score > this.hallOfFame[this.hallOfFame.length - 1].score;
            },
            
            showNameInput() {
                document.getElementById('final-score').innerText = this.score;
                document.getElementById('player-name').value = '';
                document.getElementById('name-input').style.display = 'flex';
                setTimeout(() => document.getElementById('player-name').focus(), 100);
            },
            
            saveScore() {
                const name = document.getElementById('player-name').value.trim() || 'Anonim';
                
                this.hallOfFame.push({ name: name, score: this.score });
                this.hallOfFame.sort((a, b) => b.score - a.score);
                this.hallOfFame = this.hallOfFame.slice(0, 3);
                
                this.saveHallOfFame();
                this.renderHallOfFame();
                
                document.getElementById('name-input').style.display = 'none';
                this.showGameOver();
            },

            createInitialClouds() {
                for(let i=0; i<20; i++) {
                    this.spawnCloud(true);
                }
            },

            spawnCloud(randomX = false) {
                const c = document.createElement('div');
                c.className = 'cloud';
                
                const layer = Math.random();
                let size, speed, opacity, zIndex;
                
                if(layer < 0.5) { 
                    size = Math.random() * 60 + 40;
                    speed = Math.random() * 10 + 20; 
                    opacity = Math.random() * 0.4 + 0.1;
                    zIndex = 1;
                } else if (layer < 0.8) { 
                    size = Math.random() * 80 + 70;
                    speed = Math.random() * 8 + 12;
                    opacity = Math.random() * 0.5 + 0.3;
                    zIndex = 2;
                } else { 
                    size = Math.random() * 100 + 100;
                    speed = Math.random() * 5 + 8; 
                    opacity = Math.random() * 0.6 + 0.4;
                    zIndex = 3;
                }

                c.style.width = size + 'px';
                c.style.height = (size * 0.6) + 'px';
                c.style.top = Math.random() * 100 + '%';
                c.style.left = randomX ? Math.random() * 100 + '%' : '110%';
                c.style.opacity = opacity;
                c.style.zIndex = zIndex;
                
                document.getElementById('game-area').insertBefore(c, document.getElementById('player'));
                
                c.style.transition = `left ${speed}s linear`;
                c.offsetWidth; 
                c.style.left = '-20%';
                
                setTimeout(() => c.remove(), speed * 1000);
            },

            start() {
                this.currentLevelIdx = 0;
                this.startLevel();
            },

            startLevel() {
                const levelKey = this.levelKeys[this.currentLevelIdx];
                const levelData = LEVELS[levelKey];
                
                // Initialize question pools by difficulty
                this.currentQuestions = {
                    easy: [...levelData.questions.easy],
                    medium: [...levelData.questions.medium],
                    hard: [...levelData.questions.hard]
                };

                this.levelProgress = 0;
                this.pendingQuestionIdx = null;
                this.pendingQuestionDiff = null;
                
                // Zmie≈Ñ t≈Ço na odpowiednie dla poziomu
                document.body.classList.remove('level-easy', 'level-medium', 'level-hard');
                document.body.classList.add('level-' + levelKey.toLowerCase());
                
                document.getElementById('menu-screen').style.display = 'none';
                document.getElementById('nuke-flash').style.display = 'none';
                
                // Resetuj stan przed countdown
                this.running = false;
                this.paused = true;
                this.pX = 10; this.pY = 50;
                this.frame = 0;
                
                document.getElementById('game-objects').innerHTML = '';
                this.objects = [];
                this.particles = [];
                
                // Ustaw pozycjƒô samolotu
                const p = document.getElementById('player');
                const xPx = (this.pX / 100) * this.width;
                const yPx = (this.pY / 100) * this.height;
                p.style.transform = `translate3d(${xPx}px, ${yPx}px, 0)`;
                p.style.top = '0'; p.style.left = '0';
                
                if(this.currentLevelIdx === 0) {
                    this.score = 0; this.fuel = 100; this.lives = 3;
                    this.weaponLevel = 1;
                    this.disableUfo(); // Reset UFO na nowƒÖ grƒô
                } else {
                    this.fuel = Math.min(100, this.fuel + 50);
                }
                
                this.updateUI();
                
                // Poka≈º countdown - gracz mo≈ºe siƒô ruszaƒá
                this.countdown = true;
                this.showCountdown(() => {
                    this.countdown = false;
                    this.running = true;
                    this.paused = false;
                }, levelData.name);
            },

            showLevelTitle(text) {
                const el = document.createElement('div');
                el.innerText = "LEVEL: " + text;
                el.style.position = 'fixed';
                el.style.top = '50%'; el.style.left = '50%';
                el.style.transform = 'translate(-50%, -50%) scale(0)';
                el.style.fontSize = '80px';
                el.style.color = '#f1c40f';
                el.style.textShadow = '0 5px 10px rgba(0,0,0,0.5)';
                el.style.transition = 'transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                el.style.zIndex = '1000';
                document.body.appendChild(el);
                
                setTimeout(() => el.style.transform = 'translate(-50%, -50%) scale(1)', 100);
                setTimeout(() => {
                    el.style.opacity = '0';
                    setTimeout(() => el.remove(), 500);
                }, 2000);
            },
            
            showCountdown(callback, levelName) {
                const overlay = document.createElement('div');
                overlay.className = 'countdown-overlay';
                document.body.appendChild(overlay);
                
                const steps = [
                    { text: 'Ready?', delay: 0 },
                    { text: 'Steady?', delay: 800 },
                    { text: 'GO PITAGORAS GO!!!', delay: 1600, isGo: true }
                ];
                
                const levelLabel = levelName ? `<div class="countdown-level">LEVEL: ${levelName}</div>` : '';
                
                steps.forEach(step => {
                    setTimeout(() => {
                        overlay.innerHTML = `
                            <div class="countdown-wrapper">
                                <div class="countdown-text ${step.isGo ? 'go' : ''}">${step.text}</div>
                            </div>
                            ${levelLabel}
                        `;
                    }, step.delay);
                });
                
                setTimeout(() => {
                    overlay.style.transition = 'opacity 0.3s';
                    overlay.style.opacity = '0';
                    setTimeout(() => {
                        overlay.remove();
                        if(callback) callback();
                    }, 300);
                }, 2400);
            },

            loop(timestamp) {
                // Pƒôtla zawsze dzia≈Ça dla animacji chmur
                requestAnimationFrame(this.loop);
                
                // Oblicz deltaTime (normalizacja do 60 FPS)
                if(this.lastFrameTime === 0) this.lastFrameTime = timestamp;
                const rawDelta = (timestamp - this.lastFrameTime) / (1000 / TARGET_FPS);
                this.deltaTime = Math.min(rawDelta, 3); // Cap na 3 ≈ºeby uniknƒÖƒá skok√≥w po pauzie
                this.lastFrameTime = timestamp;
                
                const dt = this.deltaTime;
                
                // Ruch gracza dzia≈Ça podczas countdown (ale nie podczas pytania/pauzy)
                if(this.countdown || (this.running && !this.paused)) {
                    const playerSpd = CONFIG.playerSpeed * dt;
                    if(this.keys['ArrowUp'] && this.pY > 2) this.pY -= playerSpd;
                    if(this.keys['ArrowDown'] && this.pY < 90) this.pY += playerSpd;
                    if(this.keys['ArrowLeft'] && this.pX > 2) this.pX -= playerSpd;
                    if(this.keys['ArrowRight'] && this.pX < 90) this.pX += playerSpd;

                    const p = document.getElementById('player');
                    const xPx = (this.pX / 100) * this.width;
                    const yPx = (this.pY / 100) * this.height;
                    p.style.transform = `translate3d(${xPx}px, ${yPx}px, 0)`;
                    p.style.top = '0'; p.style.left = '0';
                    
                    if(this.frame % 3 === 0) this.createEngineTrail();
                    this.updateParticles(dt);
                }
                
                if(!this.running || this.paused) return;
                
                this.frame++;
                const levelData = LEVELS[this.levelKeys[this.currentLevelIdx]];
                const ss = this.speedScale;
                
                const p = document.getElementById('player');
                const xPx = (this.pX / 100) * this.width;
                const yPx = (this.pY / 100) * this.height;
                
                this.fuel -= (levelData.fuelDrain || CONFIG.fuelDrain) * dt;
                if(this.fuel <= 0) { this.fuel = 0; this.triggerNuke(); }

                // Spawnowanie (z deltaTime dla sp√≥jno≈õci)
                const hasQuestions = this.currentQuestions.easy.length > 0 || this.currentQuestions.medium.length > 0 || this.currentQuestions.hard.length > 0;
                if(Math.random() < levelData.spawnRate * dt && hasQuestions) this.spawnTarget();
                if(Math.random() < levelData.enemyRate * dt) this.spawnEnemy();
                if(Math.random() < (levelData.powerupRate || 0.003) * dt) this.spawnPowerup();
                if(Math.random() < 0.02 * dt) this.spawnCloud();

                this.updateObjects(xPx, yPx, dt, ss);
                this.updateParticles(dt);
                this.checkCollisions(xPx, yPx);
                this.updateUI();
            },

            spawnTarget() {
                // Wybierz losowƒÖ kategoriƒô trudno≈õci, ale tylko z dostƒôpnych
                const available = [];
                if(this.currentQuestions.easy.length > 0) available.push('easy');
                if(this.currentQuestions.medium.length > 0) available.push('medium');
                if(this.currentQuestions.hard.length > 0) available.push('hard');
                
                if(available.length === 0) return; // Brak pyta≈Ñ
                
                // Losuj z wagami: easy 50%, medium 35%, hard 15%
                let difficulty;
                const rand = Math.random();
                if(rand < 0.5 && available.includes('easy')) difficulty = 'easy';
                else if(rand < 0.85 && available.includes('medium')) difficulty = 'medium';
                else if(available.includes('hard')) difficulty = 'hard';
                else difficulty = available[Math.floor(Math.random() * available.length)]; // fallback
                
                const t = document.createElement('div');
                let cls = 'target target-' + difficulty;
                
                t.className = cls;
                t.style.top = '0'; t.style.left = '0';
                
                const inner = document.createElement('div');
                inner.className = 'target-content';
                inner.innerText = '?';
                t.appendChild(inner);

                document.getElementById('game-objects').appendChild(t);
                
                const startY = (Math.random() * 80 + 10) / 100 * this.height;
                const startX = this.width + 50;

                this.objects.push({ 
                    el: t, 
                    x: startX, 
                    y: startY, 
                    width: 60, height: 60,
                    isTarget: true,
                    difficulty: difficulty, // Zapisz trudno≈õƒá dla openQuestion
                    speed: (this.width * 0.003) + Math.random() * 2 
                });
            },

            spawnEnemy() {
                const levelData = LEVELS[this.levelKeys[this.currentLevelIdx]];
                const scale = levelData.enemyScale || 1.0;
                
                const type = Math.random();
                let cls, formula, baseW, baseH;
                
                if(type < 0.33) {
                    cls = 'enemy-square'; formula = 'a¬≤'; baseW=50; baseH=50;
                } else if(type < 0.66) {
                    cls = 'enemy-circle'; formula = 'œÄr¬≤'; baseW=50; baseH=50;
                } else {
                    cls = 'enemy-triangle'; formula = 'ah/2'; baseW=60; baseH=50; 
                }
                
                const w = baseW * scale;
                const h = baseH * scale;

                const e = document.createElement('div');
                e.className = 'enemy ' + cls;
                e.style.top = '0'; e.style.left = '0';
                e.style.transform = `scale(${scale})`;
                e.style.transformOrigin = 'center center';
                
                document.getElementById('game-objects').appendChild(e);
                
                const startY = (Math.random() * 80 + 10) / 100 * this.height;
                const startX = this.width + 50;

                this.objects.push({
                    el: e,
                    x: startX, y: startY,
                    width: w, height: h,
                    isEnemy: true,
                    formula: formula,
                    scale: scale,
                    hp: 1,
                    speed: CONFIG.enemySpeed + Math.random(),
                    lastShot: this.frame - 100  // Strzela od razu jak wejdzie na ekran
                });
            },

            spawnPowerup() {
                const levelData = LEVELS[this.levelKeys[this.currentLevelIdx]];
                const weights = levelData.powerups || { x2: 25, x3: 10, x4: 3, x1: 5, life: 15, boom: 2, points: 20, fuel: 20 };
                
                // Losuj typ na podstawie wag
                const total = Object.values(weights).reduce((a, b) => a + b, 0);
                let rand = Math.random() * total;
                let type = 'fuel';
                
                for(const [key, weight] of Object.entries(weights)) {
                    rand -= weight;
                    if(rand <= 0) { type = key; break; }
                }
                
                const p = document.createElement('div');
                p.className = 'powerup';
                p.style.top = '0'; p.style.left = '0';
                
                // Wewnƒôtrzny element - niespodzianka! Nie wiadomo co tam jest
                const inner = document.createElement('span');
                inner.className = 'powerup-inner';
                inner.innerText = 'üéÅ';
                p.appendChild(inner);
                
                document.getElementById('game-objects').appendChild(p);
                
                const startY = (Math.random() * 70 + 15) / 100 * this.height;
                const startX = this.width + 30;
                
                this.objects.push({
                    el: p,
                    x: startX, y: startY,
                    width: 55, height: 55,
                    isPowerup: true,
                    powerupType: type,
                    speed: 2 + Math.random() * 2
                });
            },

            shoot() {
                // Strzelanie jest darmowe - paliwo kosztuje tylko trafienie w pytanie
                const pX = (this.pX / 100) * this.width;
                const pY = (this.pY / 100) * this.height;
                
                if(this.hasUfo) {
                    // Tryb UFO - strzelanie laserem (3 lasery)
                    const laserOffsets = [-15, 0, 15];
                    laserOffsets.forEach(yOff => {
                        const laser = document.createElement('div');
                        laser.className = 'laser';
                        laser.style.top = '0'; laser.style.left = '0';
                        document.getElementById('game-objects').appendChild(laser);
                        
                        const mX = pX + 130; 
                        const mY = pY + 35 - 3 + yOff;

                        this.objects.push({ 
                            el: laser, 
                            x: mX, y: mY, 
                            width: 80, height: 6,
                            isMissile: true,
                            isLaser: true
                        });
                    });
                } else {
                    // Normalny tryb - rakiety
                    const offsets = [
                        [0],                          // x1
                        [-8, 8],                      // x2
                        [-12, 0, 12],                 // x3
                        [-15, -5, 5, 15]              // x4
                    ];
                    const yOffsets = offsets[Math.min(this.weaponLevel, 4) - 1];
                    
                    yOffsets.forEach(yOff => {
                        const m = document.createElement('div');
                        m.className = 'missile';
                        m.style.top = '0'; m.style.left = '0';
                        document.getElementById('game-objects').appendChild(m);
                        
                        const mX = pX + 90; 
                        const mY = pY + 25 - 4 + yOff;

                        this.objects.push({ 
                            el: m, 
                            x: mX, y: mY, 
                            width: 30, height: 8,
                            isMissile: true 
                        });
                    });
                }
            },

            updateObjects(playerX, playerY, dt = 1, ss = 1) {
                for(let i = this.objects.length - 1; i >= 0; i--) {
                    let obj = this.objects[i];
                    
                    if(obj.isTarget) {
                        obj.x -= obj.speed * dt * ss;
                        if(obj.x < -100) {
                            obj.el.remove();
                            this.objects.splice(i, 1);
                            // Pytanie wraca - spawnuj nowy cel
                            this.spawnTarget();
                            continue;
                        }
                    } 
                    else if (obj.isMissile) {
                        // Lasery sƒÖ szybsze ni≈º rakiety
                        const speed = obj.isLaser ? 25 : 15;
                        obj.x += speed * dt * ss;
                        if(obj.x > this.width) {
                            obj.el.remove();
                            this.objects.splice(i, 1);
                            continue;
                        }
                    }
                    else if (obj.isEnemy) {
                        obj.x -= obj.speed * dt * ss;
                        
                        if(this.frame - obj.lastShot > 120 / dt) { 
                            if(obj.x < this.width && obj.x > 0) { 
                                this.enemyShoot(obj, playerX, playerY);
                                obj.lastShot = this.frame;
                            }
                        }

                        if(obj.x < -100) {
                            obj.el.remove();
                            this.objects.splice(i, 1);
                            continue;
                        }
                    }
                    else if (obj.isProjectile) {
                        obj.x += obj.vx * dt * ss;
                        obj.y += obj.vy * dt * ss;
                        
                        if(obj.x < -50 || obj.x > this.width + 50 || obj.y < -50 || obj.y > this.height + 50) {
                            obj.el.remove();
                            this.objects.splice(i, 1);
                            continue;
                        }
                    }
                    else if (obj.isPowerup) {
                        obj.x -= obj.speed * dt * ss;
                        
                        if(obj.x < -60) {
                            obj.el.remove();
                            this.objects.splice(i, 1);
                            continue;
                        }
                    }
                    
                    // Zachowaj skalƒô dla wrog√≥w i pocisk√≥w
                    const scaleStr = obj.scale ? ` scale(${obj.scale})` : '';
                    obj.el.style.transform = `translate3d(${obj.x}px, ${obj.y}px, 0)${scaleStr}`;
                }
            },

            enemyShoot(enemy, pX, pY) {
                const levelData = LEVELS[this.levelKeys[this.currentLevelIdx]];
                const scale = levelData.projectileScale || 1.0;
                
                const proj = document.createElement('div');
                proj.className = 'enemy-projectile';
                proj.innerText = enemy.formula;
                proj.style.top = '0'; proj.style.left = '0';
                proj.style.transform = `scale(${scale})`;
                proj.style.transformOrigin = 'center center';
                
                document.getElementById('game-objects').appendChild(proj);
                
                const dx = pX - enemy.x;
                const dy = pY - enemy.y;
                const dist = Math.sqrt(dx*dx + dy*dy);
                const speed = 5;
                
                const baseW = 60, baseH = 40;
                
                this.objects.push({
                    el: proj,
                    x: enemy.x, y: enemy.y + 20,
                    vx: (dx/dist) * speed,
                    vy: (dy/dist) * speed,
                    width: baseW * scale, height: baseH * scale, 
                    isProjectile: true,
                    scale: scale
                });
            },

            updateParticles(dt = 1) {
                for(let i = this.particles.length - 1; i >= 0; i--) {
                    let p = this.particles[i];
                    p.life -= dt;
                    p.x += p.vx * dt; p.y += p.vy * dt;
                    if(p.gravity) p.vy += 0.2 * dt;
                    if(p.friction) p.vx *= Math.pow(0.95, dt);
                    p.opacity -= p.decay * dt;
                    
                    if(p.life <= 0 || p.opacity <= 0) {
                        p.el.remove();
                        this.particles.splice(i, 1);
                        continue;
                    }
                    p.el.style.opacity = p.opacity;
                    const s = p.scale ? `scale(${p.opacity})` : '';
                    p.el.style.transform = `translate3d(${p.x}px, ${p.y}px, 0) ${s}`;
                }
            },

            checkCollisions(pX, pY) {
                const pRect = { left: pX + 10, right: pX + 90, top: pY + 10, bottom: pY + 40 };

                for(let i = this.objects.length - 1; i >= 0; i--) {
                    let obj = this.objects[i];
                    const oRect = { left: obj.x, right: obj.x + obj.width, top: obj.y, bottom: obj.y + obj.height };
                    
                    if(obj.isTarget && this.rectIntersect(pRect, oRect)) {
                        this.openQuestion(obj.difficulty);
                        obj.el.remove();
                        this.objects.splice(i, 1);
                        continue;
                    }
                    
                    if(obj.isProjectile && this.rectIntersect(pRect, oRect)) {
                        if(this.isInvincible) {
                            // UFO MODE - niszcz pocisk, nie gracza!
                            this.createExplosion(obj.x + 15, obj.y + 10);
                            this.score += 5;
                            obj.el.remove();
                            this.objects.splice(i, 1);
                        } else {
                            this.triggerNuke(); 
                            obj.el.remove();
                            this.objects.splice(i, 1);
                        }
                        continue;
                    }
                    
                    // Kolizja z wrogiem
                    if(obj.isEnemy && this.rectIntersect(pRect, oRect)) {
                        this.createExplosion(obj.x + 25, obj.y + 25);
                        if(this.isInvincible) {
                            // UFO MODE - niszcz wroga, nie gracza!
                            this.score += 50;
                        } else {
                            this.triggerNuke(); 
                        }
                        obj.el.remove();
                        this.objects.splice(i, 1);
                        continue;
                    }
                    
                    // Kolizja z power-upem
                    if(obj.isPowerup && this.rectIntersect(pRect, oRect)) {
                        this.collectPowerup(obj.powerupType);
                        obj.el.remove();
                        this.objects.splice(i, 1);
                        continue;
                    }

                    if(obj.isMissile) {
                        let missileHit = false;
                        for(let j = this.objects.length - 1; j >= 0; j--) {
                            if(missileHit) break;
                            let target = this.objects[j];
                            
                            if(target.isEnemy) {
                                const tRect = { left: target.x, right: target.x + target.width, top: target.y, bottom: target.y + target.height };
                                if(this.rectIntersect(oRect, tRect)) {
                                    this.createExplosion(target.x + 25, target.y + 25);
                                    this.score += 25;
                                    obj.el.remove();
                                    target.el.remove();
                                    // Usu≈Ñ w odpowiedniej kolejno≈õci
                                    if(j > i) {
                                        this.objects.splice(j, 1);
                                        this.objects.splice(i, 1);
                                    } else {
                                        this.objects.splice(i, 1);
                                        this.objects.splice(j, 1);
                                    }
                                    missileHit = true;
                                }
                            }
                            else if(target.isTarget) {
                                const tRect = { left: target.x, right: target.x + target.width, top: target.y, bottom: target.y + target.height };
                                if(this.rectIntersect(oRect, tRect)) {
                                    this.createExplosion(target.x + 30, target.y + 30);
                                    this.score += 10;
                                    this.fuel -= CONFIG.fuelShotCost;
                                    obj.el.remove();
                                    target.el.remove();
                                    if(j > i) {
                                        this.objects.splice(j, 1);
                                        this.objects.splice(i, 1);
                                    } else {
                                        this.objects.splice(i, 1);
                                        this.objects.splice(j, 1);
                                    }
                                    missileHit = true;
                                }
                            }
                            else if(target.isProjectile) {
                                const tRect = { left: target.x, right: target.x + target.width, top: target.y, bottom: target.y + target.height };
                                if(this.rectIntersect(oRect, tRect)) {
                                    this.createExplosion(target.x + 15, target.y + 10);
                                    this.score += 5;
                                    obj.el.remove();
                                    target.el.remove();
                                    if(j > i) {
                                        this.objects.splice(j, 1);
                                        this.objects.splice(i, 1);
                                    } else {
                                        this.objects.splice(i, 1);
                                        this.objects.splice(j, 1);
                                    }
                                    missileHit = true;
                                }
                            }
                        }
                        if(missileHit) continue;
                    }
                }
            },

            rectIntersect(r1, r2) {
                return !(r2.left > r1.right || r2.right < r1.left || r2.top > r1.bottom || r2.bottom < r1.top);
            },
            
            collectPowerup(type) {
                const messages = {
                    x2: 'üî´ BRO≈É √ó2!',
                    x3: 'üî´ BRO≈É √ó3!',
                    x4: 'üî´ BRO≈É √ó4!',
                    x1: 'üò¢ BRO≈É √ó1',
                    life: '‚ù§Ô∏è +1 ≈ªYCIE!',
                    boom: 'üí• BOOM!',
                    points: '‚≠ê +50 PKT!',
                    fuel: '‚õΩ +30% PALIWA!',
                    ufo: 'üõ∏ UFO LASER MODE!'
                };
                
                switch(type) {
                    case 'x2': this.weaponLevel = Math.max(this.weaponLevel, 2); break;
                    case 'x3': this.weaponLevel = Math.max(this.weaponLevel, 3); break;
                    case 'x4': this.weaponLevel = 4; break;
                    case 'x1': this.weaponLevel = 1; this.disableUfo(); break;
                    case 'life': this.lives++; break;
                    case 'boom': this.triggerNuke(); return; // Nie pokazuj wiadomo≈õci
                    case 'points': this.score += 50; break;
                    case 'fuel': this.fuel = Math.min(100, this.fuel + 30); break;
                    case 'ufo': this.enableUfo(); break;
                }
                
                this.showPowerupMessage(messages[type]);
                this.updateUI();
            },
            
            enableUfo() {
                // Wyczy≈õƒá poprzedni timer je≈õli istnieje
                if(this.ufoTimer) clearInterval(this.ufoTimer);
                if(this.ufoTimeout) clearTimeout(this.ufoTimeout);
                
                this.hasUfo = true;
                this.isInvincible = true;
                this.ufoTimeLeft = 15;
                
                const player = document.getElementById('player');
                player.classList.add('ufo-mode');
                
                // Poka≈º timer bar
                const timerEl = document.getElementById('ufo-timer');
                const timerBar = document.getElementById('ufo-timer-bar');
                timerEl.style.display = 'block';
                timerBar.style.width = '100%';
                
                // Countdown timer
                this.ufoTimer = setInterval(() => {
                    this.ufoTimeLeft -= 0.1;
                    const percent = (this.ufoTimeLeft / 10) * 100;
                    timerBar.style.width = percent + '%';
                    
                    if(this.ufoTimeLeft <= 3) {
                        timerBar.style.background = 'linear-gradient(90deg, #ff4757, #ff6b6b)';
                    }
                }, 100);
                
                // Auto wy≈ÇƒÖcz po 10 sekundach
                this.ufoTimeout = setTimeout(() => {
                    this.disableUfo();
                }, 10000);
                
                // Zmie≈Ñ SVG na UFO
                player.innerHTML = `
                    <svg viewBox="0 0 140 70" style="width:100%; height:100%;">
                        <defs>
                            <linearGradient id="ufoBody" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#2ecc71;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#27ae60;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#1e8449;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="ufoDome" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#00ffff;stop-opacity:0.9" />
                                <stop offset="100%" style="stop-color:#00bfff;stop-opacity:0.7" />
                            </linearGradient>
                            <filter id="ufoGlowFilter">
                                <feGaussianBlur stdDeviation="3" result="glow"/>
                                <feMerge><feMergeNode in="glow"/><feMergeNode in="SourceGraphic"/></feMerge>
                            </filter>
                        </defs>
                        <!-- G≈Ç√≥wne ≈õwiat≈Ço spodu -->
                        <ellipse cx="70" cy="55" rx="30" ry="8" fill="#7fff00" opacity="0.4">
                            <animate attributeName="opacity" values="0.3;0.6;0.3" dur="0.5s" repeatCount="indefinite"/>
                        </ellipse>
                        <!-- Spodek UFO -->
                        <ellipse cx="70" cy="45" rx="60" ry="15" fill="url(#ufoBody)" stroke="#1e8449" stroke-width="2"/>
                        <!-- ≈öwiat≈Ça na spodku -->
                        <circle cx="30" cy="48" r="4" fill="#ff0">
                            <animate attributeName="opacity" values="1;0.3;1" dur="0.3s" repeatCount="indefinite"/>
                        </circle>
                        <circle cx="50" cy="52" r="4" fill="#f00">
                            <animate attributeName="opacity" values="0.3;1;0.3" dur="0.4s" repeatCount="indefinite"/>
                        </circle>
                        <circle cx="70" cy="54" r="4" fill="#0ff">
                            <animate attributeName="opacity" values="1;0.5;1" dur="0.2s" repeatCount="indefinite"/>
                        </circle>
                        <circle cx="90" cy="52" r="4" fill="#f0f">
                            <animate attributeName="opacity" values="0.5;1;0.5" dur="0.35s" repeatCount="indefinite"/>
                        </circle>
                        <circle cx="110" cy="48" r="4" fill="#0f0">
                            <animate attributeName="opacity" values="1;0.3;1" dur="0.25s" repeatCount="indefinite"/>
                        </circle>
                        <!-- Kopu≈Ça -->
                        <ellipse cx="70" cy="35" rx="30" ry="25" fill="url(#ufoDome)" stroke="#00ffff" stroke-width="2" filter="url(#ufoGlowFilter)"/>
                        <!-- Alien inside -->
                        <ellipse cx="70" cy="32" rx="10" ry="12" fill="#1a1a2e"/>
                        <ellipse cx="65" cy="30" rx="4" ry="5" fill="#00ff00">
                            <animate attributeName="fill" values="#00ff00;#adff2f;#00ff00" dur="1s" repeatCount="indefinite"/>
                        </ellipse>
                        <ellipse cx="75" cy="30" rx="4" ry="5" fill="#00ff00">
                            <animate attributeName="fill" values="#00ff00;#adff2f;#00ff00" dur="1s" repeatCount="indefinite"/>
                        </ellipse>
                        <!-- Laser dzia≈Ço -->
                        <rect x="125" y="42" width="15" height="6" fill="#7fff00" rx="2"/>
                        <circle cx="140" cy="45" r="4" fill="#00ff00">
                            <animate attributeName="r" values="3;5;3" dur="0.2s" repeatCount="indefinite"/>
                        </circle>
                    </svg>
                `;
            },
            
            disableUfo() {
                this.hasUfo = false;
                this.isInvincible = false;
                
                // Wyczy≈õƒá timery
                if(this.ufoTimer) clearInterval(this.ufoTimer);
                if(this.ufoTimeout) clearTimeout(this.ufoTimeout);
                
                // Ukryj timer bar
                document.getElementById('ufo-timer').style.display = 'none';
                document.getElementById('ufo-timer-bar').style.background = 'linear-gradient(90deg, #00ff00, #7fff00, #adff2f)';
                
                const player = document.getElementById('player');
                player.classList.remove('ufo-mode');
                
                // Przywr√≥ƒá oryginalny ≈Çadny samolot
                player.innerHTML = `
                    <svg viewBox="0 0 100 50" style="width:100%; height:100%;">
                        <defs>
                            <linearGradient id="fuselage" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#7f8c8d;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#bdc3c7;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#7f8c8d;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="wings" x1="0%" y1="0%" x2="0%" y2="100%">
                                <stop offset="0%" style="stop-color:#95a5a6;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#7f8c8d;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <!-- Engine Flame -->
                        <path d="M0 25 L-15 20 L-15 30 Z" fill="#e67e22" style="animation: flicker 0.1s infinite"/>
                        <path d="M-5 25 L-12 22 L-12 28 Z" fill="#f1c40f" style="animation: flicker 0.1s infinite alternate"/>
                        
                        <!-- Main Body -->
                        <path d="M10 20 L90 25 L100 30 L90 35 L10 40 L0 30 Z" fill="url(#fuselage)" stroke="#2c3e50" stroke-width="2"/>
                        
                        <!-- Wings -->
                        <path d="M40 30 L20 50 L70 35 Z" fill="url(#wings)" stroke="#2c3e50" stroke-width="2"/>
                        <path d="M40 30 L20 5 L70 25 Z" fill="url(#wings)" stroke="#2c3e50" stroke-width="2"/>
                        
                        <!-- Cockpit -->
                        <path d="M60 22 L80 25 L60 28 Z" fill="#3498db" stroke="#2980b9" stroke-width="1"/>
                        <path d="M65 23 L75 25 L65 26 Z" fill="rgba(255,255,255,0.6)" />
                        
                        <!-- Details -->
                        <line x1="30" y1="25" x2="30" y2="35" stroke="#2c3e50" stroke-width="1" opacity="0.5"/>
                        <line x1="50" y1="25" x2="50" y2="35" stroke="#2c3e50" stroke-width="1" opacity="0.5"/>
                    </svg>
                `;
            },
            
            showPowerupMessage(text) {
                const el = document.createElement('div');
                el.innerText = text;
                el.style.cssText = `
                    position: fixed; top: 50%; left: 50%;
                    transform: translate(-50%, -50%) scale(0);
                    font-size: 40px; font-weight: bold;
                    color: white; text-shadow: 0 3px 10px rgba(0,0,0,0.5);
                    z-index: 150; pointer-events: none;
                    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                `;
                document.body.appendChild(el);
                
                setTimeout(() => el.style.transform = 'translate(-50%, -50%) scale(1)', 50);
                setTimeout(() => {
                    el.style.opacity = '0';
                    el.style.transform = 'translate(-50%, -80%) scale(0.5)';
                    setTimeout(() => el.remove(), 300);
                }, 1000);
            },

            createEngineTrail() {
                const pX = (this.pX / 100) * this.width;
                const pY = (this.pY / 100) * this.height;

                const t = document.createElement('div');
                t.style.position = 'absolute';
                t.style.width = '10px'; t.style.height = '6px';
                t.style.background = '#f39c12';
                t.style.borderRadius = '50%';
                t.style.zIndex = '49';
                t.style.boxShadow = '0 0 5px #e67e22';
                t.style.top = '0'; t.style.left = '0';
                
                document.getElementById('game-area').appendChild(t);
                
                const startX = pX + 5;
                const startY = pY + 22 + Math.random() * 4;

                this.particles.push({
                    el: t,
                    x: startX, y: startY,
                    vx: -5, vy: 0,
                    life: 20, decay: 0.05,
                    opacity: 0.8,
                    scale: false, gravity: false, friction: false
                });
            },

            createExplosion(x, y, huge = false) {
                const count = huge ? 40 : 15;
                const colors = ['#ff4757', '#ffa502', '#feca57', '#ffffff'];
                
                for(let i=0; i<count; i++) {
                    const p = document.createElement('div');
                    p.className = 'explosion-particle';
                    const size = Math.random() * (huge ? 30 : 15) + 5;
                    p.style.width = size + 'px'; p.style.height = size + 'px';
                    p.style.background = colors[Math.floor(Math.random() * colors.length)];
                    p.style.boxShadow = `0 0 ${size}px ${p.style.background}`;
                    p.style.top = '0'; p.style.left = '0';
                    
                    document.getElementById('game-area').appendChild(p);

                    const angle = Math.random() * Math.PI * 2;
                    const speed = Math.random() * (huge ? 15 : 8) + 2;
                    
                    this.particles.push({
                        el: p,
                        x: x, y: y,
                        vx: Math.cos(angle) * speed,
                        vy: Math.sin(angle) * speed,
                        life: 50, decay: 0.02,
                        opacity: 1,
                        scale: true, gravity: true, friction: true
                    });
                }
            },

            // --- SYSTEM PYTA≈É ---
            openQuestion(difficulty) {
                this.paused = true;
                const modal = document.getElementById('modal-overlay');
                modal.style.display = 'flex';
                
                // U≈ºyj kategorii trudno≈õci przekazanej z target lub losuj
                const diff = difficulty || 'easy';
                let pool = this.currentQuestions[diff];
                
                // Je≈õli pula jest pusta, do≈Çaduj z LEVELS
                if(pool.length === 0) {
                    const levelData = LEVELS[this.levelKeys[this.currentLevelIdx]];
                    this.currentQuestions[diff] = [...levelData.questions[diff]];
                    pool = this.currentQuestions[diff];
                }
                
                const idx = Math.floor(Math.random() * pool.length);
                const q = pool[idx];
                
                // Zapisz do usuniƒôcia po poprawnej odpowiedzi
                this.pendingQuestionIdx = idx;
                this.pendingQuestionDiff = diff;
                
                document.getElementById('q-text').innerText = q.q;
                
                // Wy≈õwietl obrazek je≈õli jest
                const imgContainer = document.getElementById('question-img');
                imgContainer.innerHTML = q.img || '';
                
                const ansCont = document.getElementById('ans-container');
                ansCont.innerHTML = '';
                
                // Shuffle answers
                const answers = [
                    { text: q.a, correct: true },
                    { text: q.bad[0], correct: false },
                    { text: q.bad[1], correct: false },
                    { text: q.bad[2], correct: false }
                ];
                
                // Fisher-Yates shuffle
                for (let i = answers.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [answers[i], answers[j]] = [answers[j], answers[i]];
                }

                answers.forEach((ans, idx) => {
                    const btn = document.createElement('button');
                    btn.className = 'ans-btn';
                    if(idx === 0) btn.classList.add('selected'); // Auto-select first
                    btn.innerHTML = `<span class="ans-key">${idx + 1}</span> ${ans.text}`;
                    btn.onclick = () => this.checkAnswer(ans.correct);
                    ansCont.appendChild(btn);
                });

                // Timer
                const bar = document.getElementById('timer-bar');
                bar.style.width = '100%';
                bar.style.transition = 'width 10s linear';
                setTimeout(() => bar.style.width = '0%', 50);
                
                clearTimeout(this.modalTimer);
                this.modalTimer = setTimeout(() => {
                    this.checkAnswer(false); 
                }, 10000);
            },

            checkAnswer(correct) {
                clearTimeout(this.modalTimer);
                document.getElementById('modal-overlay').style.display = 'none';
                document.getElementById('timer-bar').style.transition = 'none';

                const diff = this.pendingQuestionDiff || 'easy';
                
                if(correct) {
                    // Usu≈Ñ pytanie z puli dopiero po poprawnej odpowiedzi
                    const pool = this.currentQuestions[diff];
                    if(this.pendingQuestionIdx !== null && this.pendingQuestionIdx < pool.length) {
                        pool.splice(this.pendingQuestionIdx, 1);
                    }
                    this.pendingQuestionIdx = null;
                    this.pendingQuestionDiff = null;
                    
                    this.score += 100;
                    this.fuel = Math.min(100, this.fuel + 25);
                    this.paused = false;
                    
                    this.levelProgress++;
                    this.updateUI();
                    
                    const levelData = LEVELS[this.levelKeys[this.currentLevelIdx]];
                    if(this.levelProgress >= levelData.targetCount) {
                        this.completeLevel();
                    }

                } else {
                    // Pytanie zostaje w puli - bƒôdzie mo≈ºna je dostaƒá ponownie
                    this.pendingQuestionIdx = null;
                    this.pendingQuestionDiff = null;
                    this.triggerNuke();
                }
            },
            
            launchFireworks() {
                const colors = [
                    '#ff0000', '#ff4444', '#ffff00', '#ffaa00', 
                    '#00ff00', '#44ff88', '#00ffff', '#00aaff',
                    '#ff00ff', '#ff66ff', '#ff69b4', '#7fff00',
                    '#ffffff', '#ffd700'
                ];
                const gameArea = document.getElementById('game-area');
                
                const createFirework = (size = 'normal') => {
                    const x = 80 + Math.random() * (this.width - 160);
                    const y = 80 + Math.random() * (this.height - 250);
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    const color2 = colors[Math.floor(Math.random() * colors.length)];
                    const particleCount = size === 'big' ? 50 : 35;
                    const baseDistance = size === 'big' ? 180 : 120;
                    
                    // Pier≈õcie≈Ñ eksplozji
                    const ring = document.createElement('div');
                    ring.className = 'firework-ring';
                    ring.style.left = (x - 40) + 'px';
                    ring.style.top = (y - 40) + 'px';
                    ring.style.width = '80px';
                    ring.style.height = '80px';
                    ring.style.borderColor = color;
                    gameArea.appendChild(ring);
                    setTimeout(() => ring.remove(), 1000);
                    
                    // G≈Ç√≥wna eksplozja - particles
                    for(let i = 0; i < particleCount; i++) {
                        const particle = document.createElement('div');
                        particle.className = 'firework-particle' + (Math.random() > 0.7 ? ' large' : '');
                        particle.style.left = x + 'px';
                        particle.style.top = y + 'px';
                        
                        const useColor = Math.random() > 0.5 ? color : color2;
                        particle.style.background = useColor;
                        particle.style.boxShadow = `0 0 10px ${useColor}, 0 0 20px ${useColor}, 0 0 30px ${useColor}`;
                        
                        const angle = (i / particleCount) * Math.PI * 2 + Math.random() * 0.3;
                        const distance = baseDistance + Math.random() * 100;
                        const tx = Math.cos(angle) * distance;
                        const ty = Math.sin(angle) * distance + Math.random() * 40; // gravity
                        
                        particle.style.setProperty('--tx', tx + 'px');
                        particle.style.setProperty('--ty', ty + 'px');
                        particle.style.animationDuration = (1.5 + Math.random() * 0.8) + 's';
                        
                        gameArea.appendChild(particle);
                        setTimeout(() => particle.remove(), 2500);
                    }
                    
                    // Wewnƒôtrzna eksplozja
                    for(let i = 0; i < 15; i++) {
                        const inner = document.createElement('div');
                        inner.className = 'firework-particle';
                        inner.style.left = x + 'px';
                        inner.style.top = y + 'px';
                        inner.style.background = '#fff';
                        inner.style.boxShadow = `0 0 15px #fff, 0 0 30px ${color}`;
                        
                        const angle = Math.random() * Math.PI * 2;
                        const distance = 30 + Math.random() * 50;
                        inner.style.setProperty('--tx', (Math.cos(angle) * distance) + 'px');
                        inner.style.setProperty('--ty', (Math.sin(angle) * distance) + 'px');
                        inner.style.animationDuration = '0.8s';
                        
                        gameArea.appendChild(inner);
                        setTimeout(() => inner.remove(), 1000);
                    }
                    
                    // Ogony/iskry spadajƒÖce
                    for(let i = 0; i < 20; i++) {
                        setTimeout(() => {
                            const spark = document.createElement('div');
                            spark.className = 'firework-trail';
                            const sparkX = x + (Math.random() - 0.5) * baseDistance;
                            const sparkY = y + (Math.random() - 0.5) * baseDistance;
                            spark.style.left = sparkX + 'px';
                            spark.style.top = sparkY + 'px';
                            spark.style.background = Math.random() > 0.5 ? color : '#fff';
                            spark.style.boxShadow = `0 0 8px ${color}`;
                            gameArea.appendChild(spark);
                            setTimeout(() => spark.remove(), 1200);
                        }, Math.random() * 400);
                    }
                };
                
                // Seria fajerwerk√≥w - wiƒôcej i bardziej spektakularnie!
                const schedule = [
                    {time: 0, size: 'big'},
                    {time: 150, size: 'normal'},
                    {time: 300, size: 'normal'},
                    {time: 500, size: 'big'},
                    {time: 700, size: 'normal'},
                    {time: 850, size: 'normal'},
                    {time: 1000, size: 'big'},
                    {time: 1200, size: 'normal'},
                    {time: 1400, size: 'normal'},
                    {time: 1600, size: 'big'},
                    {time: 1800, size: 'normal'},
                    {time: 2000, size: 'normal'},
                    {time: 2200, size: 'normal'},
                    {time: 2400, size: 'big'},
                    {time: 2600, size: 'normal'},
                    {time: 2800, size: 'big'},
                    {time: 3000, size: 'normal'},
                    {time: 3200, size: 'normal'},
                    {time: 3500, size: 'big'},
                    {time: 3700, size: 'big'},
                ];
                
                schedule.forEach(fw => {
                    setTimeout(() => createFirework(fw.size), fw.time);
                });
            },
            
            completeLevel() {
                this.paused = true;
                
                // Uruchom fajerwerki!
                this.launchFireworks();
                
                const isLast = this.currentLevelIdx >= this.levelKeys.length - 1;
                const menu = document.getElementById('menu-screen');
                
                if(isLast) {
                    this.running = false; // Tylko na ko≈Ñcu zatrzymaj grƒô
                    menu.innerHTML = `
                        <div class="grid-bg"></div>
                        <div class="math-bg" id="math-bg"></div>
                        <div class="menu-content">
                            <h1 style="color:#2ecc71; font-size:70px; text-shadow: 0 0 30px rgba(46,204,113,0.5);">üèÜ MISJA UKO≈ÉCZONA! üèÜ</h1>
                            <h2 style="color:rgba(255,255,255,0.9); margin: 20px 0;">Jeste≈õ matematycznym asem!</h2>
                            <h3 style="color:#f1c40f; font-size: 32px;">Wynik ko≈Ñcowy: ${this.score}</h3>
                            <button class="big-btn" onclick="location.reload()">üîÑ ZAGRAJ OD NOWA</button>
                        </div>
                    `;
                } else {
                    menu.innerHTML = `
                        <div class="grid-bg"></div>
                        <div class="math-bg" id="math-bg"></div>
                        <div class="menu-content">
                            <h1 style="color:#f1c40f; font-size:60px; text-shadow: 0 0 30px rgba(241,196,15,0.5);">‚ú® POZIOM UKO≈ÉCZONY! ‚ú®</h1>
                            <h2 style="color:rgba(255,255,255,0.9); margin: 20px 0;">Gotowy na trudniejsze zadania?</h2>
                            <button class="big-btn" onclick="Game.nextLevel()">NASTƒòPNY POZIOM ‚û°Ô∏è</button>
                        </div>
                    `;
                }
                menu.style.display = 'flex';
                this.startMathSymbols();
            },
            
            nextLevel() {
                this.currentLevelIdx++;
                this.startLevel();
            },

            // --- ATOM√ìWKA ---
            triggerNuke() {
                this.lives--;
                this.paused = true;
                this.updateUI();

                const flash = document.getElementById('nuke-flash');
                const bums = ['BUM!', 'BUM!', 'BUM!'];
                
                // Seria 3 szybkich "BUM!"
                bums.forEach((text, i) => {
                    setTimeout(() => {
                        // Flash
                        flash.style.display = 'block';
                        flash.style.animation = 'none';
                        flash.offsetHeight;
                        flash.style.animation = 'nukeFlash 0.15s';
                        
                        // Shake
                        document.body.classList.remove('screen-shake');
                        void document.body.offsetWidth;
                        document.body.classList.add('screen-shake');
                        
                        // Napis BUM
                        const bumEl = document.createElement('div');
                        bumEl.className = 'nuke-text';
                        bumEl.innerText = text;
                        bumEl.style.left = (20 + Math.random() * 60) + '%';
                        bumEl.style.top = (20 + Math.random() * 60) + '%';
                        document.body.appendChild(bumEl);
                        setTimeout(() => bumEl.remove(), 400);
                        
                        // Ma≈Ça eksplozja
                        this.createExplosion(Math.random()*this.width, Math.random()*this.height, false);
                    }, i * 200);
                });

                // Koniec efektu
                setTimeout(() => {
                    document.body.classList.remove('screen-shake');
                    flash.style.display = 'none';
                    
                    if(this.lives <= 0) {
                        this.gameOver();
                    } else {
                        this.paused = false;
                        this.fuel = 50;
                    }
                }, 700);
            },

            updateUI() {
                document.getElementById('score').innerText = this.score;
                document.getElementById('fuel-bar').style.width = this.fuel + '%';
                document.getElementById('fuel-label').innerText = Math.floor(this.fuel) + '%';
                
                let heartsStr = '';
                for(let i=0; i<this.lives; i++) heartsStr += '‚ù§Ô∏è';
                document.getElementById('hearts').innerText = heartsStr;
                
                // Weapon level
                const weaponEl = document.getElementById('weapon-level');
                weaponEl.innerText = '√ó' + this.weaponLevel;
                weaponEl.style.color = this.weaponLevel >= 3 ? '#f1c40f' : (this.weaponLevel >= 2 ? '#3498db' : '#fff');
                
                // Level info
                const levelKey = this.levelKeys[this.currentLevelIdx];
                const levelData = LEVELS[levelKey];
                document.getElementById('level-name').innerText = levelData.name;
                document.getElementById('level-name').style.color = levelData.color;
                const progressPercent = Math.round((this.levelProgress / levelData.targetCount) * 100);
                document.getElementById('progress-bar').style.width = progressPercent + '%';
                document.getElementById('progress-label').innerText = progressPercent + '%';
            },

            gameOver() {
                this.running = false;
                document.body.classList.remove('screen-shake');
                
                // Sprawd≈∫ czy nowy rekord
                if(this.isHighScore(this.score)) {
                    this.showNameInput();
                } else {
                    this.showGameOver();
                }
            },
            
            showGameOver() {
                const menu = document.getElementById('menu-screen');
                menu.innerHTML = `
                    <!-- Animowane t≈Ço -->
                    <div class="grid-bg"></div>
                    <div class="math-bg" id="math-bg"></div>
                    
                    <div class="menu-content">
                        <h1 class="game-over-title">GAME OVER</h1>
                        <p class="final-score">Tw√≥j wynik: <span>${this.score}</span> pkt</p>
                        <div id="hall-of-fame" class="hall-of-fame"></div>
                        <button class="big-btn" onclick="Game.start()">üîÑ ZAGRAJ PONOWNIE</button>
                    </div>
                    
                    <!-- Stopka -->
                    <div class="menu-footer">
                        <p class="school-name">Spo≈Çeczna Jedynka im. ≈õw. Urszuli Leduchowskiej w Poznaniu</p>
                    </div>
                `;
                menu.style.display = 'flex';
                
                // Ponownie renderuj Hall of Fame w nowym kontenerze
                setTimeout(() => this.renderHallOfFame(), 10);
                
                // Restartuj animacje symboli
                this.startMathSymbols();
            },
            
            startMathSymbols() {
                const items = [
                    'œÄ', '‚àë', '‚àö', 'Œî', '‚àû', 'Œ±', 'Œ≤', 'Œ∏', '‚à†', '‚äø',
                    'a¬≤+b¬≤=c¬≤', 'P=¬Ωah', 'S=œÄr¬≤', '180¬∞', '360¬∞', 
                    '‚ñ≥', '‚ñ¢', '‚óã', '‚ñΩ', '‚óá'
                ];
                const container = document.getElementById('math-bg');
                if(!container) return;
                
                for(let i = 0; i < 12; i++) {
                    setTimeout(() => this.createMathItem(container, items), i * 500);
                }
                
                // Kontynuuj dodawanie
                const interval = setInterval(() => {
                    if(document.getElementById('menu-screen').style.display === 'none') {
                        clearInterval(interval);
                        return;
                    }
                    this.createMathItem(container, items);
                }, 2000);
            },
            
            createMathItem(container, items) {
                if(!container || container.children.length > 18) return;
                
                const el = document.createElement('span');
                el.className = 'math-symbol';
                el.textContent = items[Math.floor(Math.random() * items.length)];
                el.style.left = (5 + Math.random() * 90) + '%';
                el.style.fontSize = (18 + Math.random() * 22) + 'px';
                
                const duration = 18 + Math.random() * 12;
                el.style.animationDuration = duration + 's';
                container.appendChild(el);
                
                setTimeout(() => el.remove(), duration * 1000);
            }
        };

        Game.init();
    </script>
</body>
</html>